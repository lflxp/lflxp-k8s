import{j as e,d as f,Q as T,R as S,B as D,V as E,W as d,X as R,Y as x,r as c,_ as M,a2 as H,C as I,aB as k,aC as O,aE as A,H as B,p as P,T as $,q as J,M as V,aI as z,a5 as F,c as q}from"./index-DIz91kq1.js";import{A as p,a as v,C as K,E as U}from"./react-icons.esm-Dz6ND8ra.js";import{T as w,d as N,b as o,e as m,u as W,l as _,a as L,c as Q,f as b}from"./table-fUaVV9X6.js";import{D as X,a as Y,b as G,R as Z}from"./drawer-DXhVnXTu.js";import{J as ee}from"./main-CzrgvI0G.js";function C({column:s,title:t,className:a}){return s.getCanSort()?e.jsx("div",{className:f("flex items-center space-x-2",a),children:e.jsxs(T,{children:[e.jsx(S,{asChild:!0,children:e.jsxs(D,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:t}),s.getIsSorted()==="desc"?e.jsx(p,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(v,{className:"ml-2 h-4 w-4"}):e.jsx(K,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(E,{align:"start",children:[e.jsxs(d,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(v,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(d,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(p,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs(d,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(U,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:f(a),children:t})}const y=c.createContext(null);function se({children:s}){const[t,a]=x.useState(null),[n,r]=x.useState(null),[l,i]=x.useState(void 0);return e.jsx(y.Provider,{value:{open:t,setOpen:a,currentRow:n,setCurrentRow:r,EventName:l,setEventName:i},children:s})}const h=()=>{const s=c.useContext(y);if(!s)throw new Error("useEvents must be used within a EventsProvider");return s},te=[{id:"type",header:"级别",cell:({row:s})=>{var t,a,n;return e.jsx(M,{className:`${((t=s.original)==null?void 0:t.type)==="Normal"?"bg-green-500 text-white":((a=s.original)==null?void 0:a.type)==="Warning"?"bg-red-500 text-white":"bg-gray-500 text-white"}`,children:((n=s.original)==null?void 0:n.type)||"Unknown"})}},{id:"name",header:({column:s})=>e.jsx(C,{column:s,title:"名称"}),cell:({row:s})=>{const{setOpen:t,setCurrentRow:a}=h(),n=()=>{a(s.original),t("detail")};return e.jsx("div",{children:e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:n,children:s.original.involvedObject.name})})},enableSorting:!1,enableHiding:!1},{id:"namespaces",header:({column:s})=>e.jsx(C,{column:s,title:"命名空间"}),cell:({row:s})=>s.original.metadata.namespace?e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-fit",children:s.original.metadata.namespace})}):e.jsx("div",{className:"w-fit",children:"default"}),enableSorting:!0,enableHiding:!1},{id:"类型",header:"类型",cell:({row:s})=>{var t,a;return(a=(t=s.original)==null?void 0:t.involvedObject)!=null&&a.kind?e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"w-fit",children:s.original.involvedObject.kind})}):e.jsx("div",{className:"w-fit",children:"default"})}},{id:"reason",header:"原因",cell:({row:s})=>{var t;return(t=s.original)==null?void 0:t.reason}},{id:"message",header:"详情",cell:({row:s})=>{var t;return(t=s.original)==null?void 0:t.message}},{id:"source",header:"来源",cell:({row:s})=>{var t,a;return(a=(t=s.original)==null?void 0:t.source)==null?void 0:a.component}},{id:"count",header:"次数",cell:({row:s})=>{var t;return((t=s.original)==null?void 0:t.count)||"N/A"}},{accessorKey:"creationTimestamp",header:"最近一次",cell:({row:s})=>{var u,j,g;const t=((u=s.original)==null?void 0:u.lastTimestamp)||((g=(j=s.original)==null?void 0:j.metadata)==null?void 0:g.creationTimestamp);if(!t)return"N/A";const a=Date.now()-new Date(t).getTime(),n=Math.floor(a/1e3),r=Math.floor(n/60),l=Math.floor(r/60),i=Math.floor(l/24);return i>0?`${i}d`:l>0?`${l}h`:r>0?`${r}m`:`${n}s`}}];function ae({columns:s,data:t}){var n;if(!s||!t)return e.jsx("div",{className:"rounded-md border",children:e.jsx(w,{children:e.jsx(N,{children:e.jsx(o,{children:e.jsx(m,{colSpan:(s==null?void 0:s.length)||0,className:"h-24 text-center",children:"没有数据"})})})})});const a=W({data:t,columns:s,getCoreRowModel:_()});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(w,{children:[e.jsx(L,{children:a.getHeaderGroups().map(r=>e.jsx(o,{children:r.headers.map(l=>e.jsx(Q,{children:l.isPlaceholder?null:b(l.column.columnDef.header,l.getContext())},l.id))},r.id))}),e.jsx(N,{children:(n=a.getRowModel().rows)!=null&&n.length?a.getRowModel().rows.map(r=>e.jsx(o,{"data-state":r.getIsSelected()&&"selected",children:r.getVisibleCells().map(l=>e.jsx(m,{children:b(l.column.columnDef.cell,l.getContext())},l.id))},r.id)):e.jsx(o,{children:e.jsx(m,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})})}function ne({columns:s,data:t}){return e.jsx(ae,{columns:s,data:t})}function re({open:s,onOpenChange:t,EventName:a}){const{currentRow:n}=h();return e.jsx(X,{open:s,onOpenChange:t,children:e.jsxs(Y,{className:"h-full mt-0",children:[e.jsxs(H,{className:"flex justify-center items-center mb-5",children:[a," 节点详情",e.jsx(G,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsxs(I,{children:[e.jsx(k,{children:e.jsx(O,{children:"原始JSON"})}),e.jsx(A,{className:"space-y-2",children:e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(ee,{src:n||{},enableClipboard:!0,displayDataTypes:!1,name:!1})})})]})})]})})}function le(){const{open:s,setOpen:t,currentRow:a,setCurrentRow:n,setEventName:r}=h();return e.jsx(e.Fragment,{children:a&&e.jsx(re,{open:s==="detail",onOpenChange:()=>{t(null),r(void 0),setTimeout(()=>{n(null)},500)},EventName:a==null?void 0:a.metadata.name},"event-detail")})}function ie(){const[s,t]=c.useState([]),a=async()=>{try{const n=await z.post("/api/gvr/list",{group:"",version:"v1",resource:"events",namespace:""});console.log("请求接口成功:",n.data.items),t(n.data.items)}catch(n){F({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(n,null,2)})})})}};return c.useEffect(()=>{a();const n=setInterval(a,1e4);return()=>clearInterval(n)},[]),e.jsxs(se,{children:[e.jsxs(B,{fixed:!0,children:[e.jsx(P,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx($,{}),e.jsx(J,{})]})]}),e.jsxs(V,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"事件管理"}),e.jsx("p",{className:"text-muted-foreground",children:"查看K8S事件日志"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(D,{variant:"outline",size:"sm",onClick:a,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"刷新"]})})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(ne,{data:s,columns:te})})]}),e.jsx(le,{})]})}const he=q("/_authenticated/events/")({component:ie});export{he as Route};
