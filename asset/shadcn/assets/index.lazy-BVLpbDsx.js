import{j as e,d as v,Q as z,R as K,B as c,V as O,W as b,X as L,Y as S,r as d,s as q,_ as y,a9 as B,aa as U,ab as J,ac as _,ad as R,ae as T,af as $,I as Q,ao as W,aG as X,ap as Y,aq as Z,ar as ee,at as se,au as ae,a2 as te,aH as V,a5 as M,H as re,p as ne,T as le,q as ie,M as oe,c as ce}from"./index-C8RBtD9j.js";import{A as P,a as F,C as de,E as me,P as xe,f as he,g as ge,b as ue,c as pe,d as je,e as fe}from"./react-icons.esm-Bw71x8l6.js";import{u as Ne,g as ve,h as we,i as Ce,j as be,k as Se,l as ye,T as H,a as A,b as j,c as f,f as I,d as E,e as h,m as De,n as Re}from"./table-C_DkmO8U.js";import{P as Te,a as Pe,b as Fe}from"./popover-Bk_Oen4F.js";import{S as Ie,a as ke,b as Ve,c as Me,d as He}from"./select-B72FxWQM.js";import{D as Ae,a as Ee,b as Ge}from"./drawer-D3ee4Bmv.js";import{T as ze}from"./textarea-CUkeIa7P.js";import"./index-BeTzKkUk.js";function u({column:s,title:t,className:i}){return s.getCanSort()?e.jsx("div",{className:v("flex items-center space-x-2",i),children:e.jsxs(z,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(c,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:t}),s.getIsSorted()==="desc"?e.jsx(P,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(F,{className:"ml-2 h-4 w-4"}):e.jsx(de,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(O,{align:"start",children:[e.jsxs(b,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(F,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(b,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(P,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(L,{}),e.jsxs(b,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(me,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:v(i),children:t})}const G=d.createContext(null);function Ke({children:s}){const[t,i]=S.useState(null),[a,l]=S.useState(null),[r,o]=S.useState(void 0);return e.jsx(G.Provider,{value:{open:t,setOpen:i,currentRow:a,setCurrentRow:l,CRDName:r,setCRDName:o},children:s})}const D=()=>{const s=d.useContext(G);if(!s)throw new Error("useCRDs must be used within a CRDsProvider");return s},Oe=[{accessorKey:"name",header:({column:s})=>e.jsx(u,{column:s,title:"Name"}),cell:({row:s})=>{const{setOpen:t,setCurrentRow:i}=D(),a=()=>{i(s.original),t("detail")};return e.jsx("div",{children:s.original.name.includes("/")?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap text-gray-500 cursor-default",children:s.original.name}):e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:a,children:s.original.name})})},enableSorting:!0,enableHiding:!1},{accessorKey:"shortNames",header:({column:s})=>e.jsx(u,{column:s,title:"Short Names"}),cell:({row:s})=>s.original.shortNames?s.original.shortNames[0]:"N/A",enableSorting:!0,enableHiding:!1},{accessorKey:"version",header:({column:s})=>e.jsx(u,{column:s,title:"API Version"}),cell:({row:s})=>s.original.version||"",enableSorting:!0,enableHiding:!1},{accessorKey:"group",header:({column:s})=>e.jsx(u,{column:s,title:"Group"}),cell:({row:s})=>s.original.group||"N/A",enableSorting:!0,enableHiding:!1},{accessorKey:"namespaces",header:({column:s})=>e.jsx(u,{column:s,title:"Namespaced"}),cell:({row:s})=>s.original.namespaced?e.jsx("div",{className:"font-bold text-xs text-green-500",children:s.original.namespaced?"true":"false"}):e.jsx("div",{className:"font-bold text-xs text-red-500",children:s.original.namespaced?"true":"false"}),enableSorting:!1,enableHiding:!1},{accessorKey:"kind",header:({column:s})=>e.jsx(u,{column:s,title:"Kind"}),cell:({row:s})=>s.original.kind,enableSorting:!0,enableHiding:!1},{id:"verbs",header:({column:s})=>e.jsx(u,{column:s,title:"Verbs"}),cell:({row:s})=>{var t;return(t=s.original)!=null&&t.verbs&&s.original.verbs.length>0?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible",children:s.original.verbs.join(", ")}):""},enableSorting:!0,enableHiding:!1}];function k({column:s,title:t,options:i}){const a=s==null?void 0:s.getFacetedUniqueValues(),l=new Set(s==null?void 0:s.getFilterValue());return e.jsxs(Te,{children:[e.jsx(Pe,{asChild:!0,children:e.jsxs(c,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(xe,{className:"mr-2 h-4 w-4"}),t,(l==null?void 0:l.size)>0&&e.jsxs(e.Fragment,{children:[e.jsx(q,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(y,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(y,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):i.filter(r=>l.has(r.value)).map(r=>e.jsx(y,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:r.label},r.value))})]})]})}),e.jsx(Fe,{className:"w-[200px] p-0",align:"start",children:e.jsxs(B,{children:[e.jsx(U,{placeholder:t}),e.jsxs(J,{children:[e.jsx(_,{children:"No results found."}),e.jsx(R,{children:i.map(r=>{const o=l.has(r.value);return e.jsxs(T,{onSelect:()=>{o?l.delete(r.value):l.add(r.value);const n=Array.from(l);s==null||s.setFilterValue(n.length?n:void 0)},children:[e.jsx("div",{className:v("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(he,{className:v("h-4 w-4")})}),r.icon&&e.jsx(r.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:r.label}),(a==null?void 0:a.get(r.value))&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:a.get(r.value)})]},r.value)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx($,{}),e.jsx(R,{children:e.jsx(T,{onSelect:()=>s==null?void 0:s.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Le=({fetchData:s})=>e.jsx("div",{className:"flex gap-2",children:e.jsx(c,{onClick:s,variant:"outline",children:"刷新"})});function qe({table:s,originalData:t,fetchData:i}){var o;const a=s.getState().columnFilters.length>0,l=[...new Set(t.map(n=>n.version))].map(n=>({value:n,label:n})),r=[...new Set(t.map(n=>n.group))].map(n=>({value:n,label:n}));return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(Q,{placeholder:"Filter tasks...",value:((o=s.getColumn("name"))==null?void 0:o.getFilterValue())??"",onChange:n=>{var p;return(p=s.getColumn("name"))==null?void 0:p.setFilterValue(n.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("version")&&e.jsx(k,{column:s.getColumn("version"),title:"API Version 筛选",options:l}),s.getColumn("group")&&e.jsx(k,{column:s.getColumn("group"),title:"Group 筛选",options:r})]}),a&&e.jsxs(c,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(ge,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Le,{fetchData:i})]})}function Be({table:s}){return e.jsxs("div",{className:"flex items-center justify-between overflow-clip px-2",style:{overflowClipMargin:1},children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[s.getFilteredSelectedRowModel().rows.length," of"," ",s.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(Ie,{value:`${s.getState().pagination.pageSize}`,onValueChange:t=>{s.setPageSize(Number(t))},children:[e.jsx(ke,{className:"h-8 w-[70px]",children:e.jsx(Ve,{placeholder:s.getState().pagination.pageSize})}),e.jsx(Me,{side:"top",children:[5,10,20,30,40,50].map(t=>e.jsx(He,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",s.getState().pagination.pageIndex+1," of"," ",s.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(c,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(ue,{className:"h-4 w-4"})]}),e.jsxs(c,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(pe,{className:"h-4 w-4"})]}),e.jsxs(c,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(je,{className:"h-4 w-4"})]}),e.jsxs(c,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(fe,{className:"h-4 w-4"})]})]})]})]})}function Ue({columns:s,data:t,fetchData:i}){var N;const[a,l]=d.useState({}),[r,o]=d.useState({}),[n,p]=d.useState([]),[w,C]=d.useState([]),g=Ne({data:t,columns:s,state:{sorting:w,columnVisibility:r,rowSelection:a,columnFilters:n},enableRowSelection:!0,onRowSelectionChange:l,onSortingChange:C,onColumnFiltersChange:p,onColumnVisibilityChange:o,getCoreRowModel:ye(),getFilteredRowModel:Se(),getPaginationRowModel:be(),getSortedRowModel:Ce(),getFacetedRowModel:we(),getFacetedUniqueValues:ve()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(qe,{table:g,originalData:t,fetchData:i}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(A,{children:g.getHeaderGroups().map(m=>e.jsx(j,{children:m.headers.map(x=>e.jsx(f,{children:x.isPlaceholder?null:I(x.column.columnDef.header,x.getContext())},x.id))},m.id))}),e.jsx(E,{children:(N=g.getRowModel().rows)!=null&&N.length?g.getRowModel().rows.map(m=>e.jsx(j,{"data-state":m.getIsSelected()&&"selected",children:m.getVisibleCells().map(x=>e.jsx(h,{children:I(x.column.columnDef.cell,x.getContext())},x.id))},m.id)):e.jsx(j,{children:e.jsx(h,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})}),e.jsx(Be,{table:g})]})}function Je({columns:s,data:t,fetchData:i}){return e.jsx(Ue,{columns:s,data:t,fetchData:i})}function _e(s,t){return e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(c,{variant:"link",children:t})}),e.jsxs(Y,{className:"w-[45%] sm:max-w-[425px]",children:[e.jsx(Z,{children:e.jsx(ee,{children:t})}),e.jsx("div",{className:"h-full",children:e.jsx("div",{className:"items-center h-full w-full",children:e.jsx(ze,{className:"h-full w-full",placeholder:"Type your message here.",value:JSON.stringify(s,null,2),readOnly:!0})})}),e.jsx(se,{children:e.jsx(ae,{asChild:!0,children:e.jsx(c,{type:"submit",children:"关闭"})})})]})]})}function $e({open:s,onOpenChange:t,CRDName:i}){const{currentRow:a}=D(),[l,r]=d.useState([]),o=async()=>{try{const n=await V.post("/api/gvr/list",{resource:a==null?void 0:a.name,group:(a==null?void 0:a.version)===void 0?"":a==null?void 0:a.group,version:(a==null?void 0:a.version)===void 0?a==null?void 0:a.group:a==null?void 0:a.version,namespace:""});r(n.data.items||[])}catch(n){M({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(n,null,2)})})})}};return d.useEffect(()=>{o()},[]),e.jsx(Ae,{open:s,onOpenChange:t,children:e.jsxs(Ee,{className:"h-full mt-0",children:[e.jsxs(te,{className:"flex justify-center items-center mb-5",children:[i," 节点详情",e.jsx(Ge,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsx("div",{className:"w-full h-full overflow-y-auto p-4 bg-gray-50 rounded-lg shadow-md",children:e.jsxs(H,{className:"min-w-full border border-gray-200",children:[e.jsx(De,{className:"text-lg font-semibold text-gray-700",children:a.kind}),e.jsx(A,{className:"bg-gray-100",children:e.jsxs(j,{children:[e.jsx(f,{className:"w-[150px] text-gray-600 font-medium",children:"Name"}),e.jsx(f,{className:"text-gray-600 font-medium",children:"Kind"}),e.jsx(f,{className:"text-gray-600 font-medium",children:"Namespace"}),e.jsx(f,{className:"text-right text-gray-600 font-medium",children:"Creation Timestamp"})]})}),e.jsx(E,{children:l.map(n=>e.jsxs(j,{className:"hover:bg-gray-100 transition-colors",children:[e.jsx(h,{className:"font-medium text-blue-600 hover:underline cursor-pointer",children:_e(n,n.metadata.name)}),e.jsx(h,{className:"text-gray-700",children:n.kind}),e.jsx(h,{className:"text-gray-700",children:n.metadata.namespace||"N/A"}),e.jsx(h,{className:"text-right text-gray-700",children:new Date(n.metadata.creationTimestamp).toLocaleString()})]},n.metadata.uid))}),e.jsx(Re,{className:"bg-gray-100",children:e.jsxs(j,{children:[e.jsx(h,{colSpan:3,className:"font-semibold text-gray-700",children:"Total"}),e.jsx(h,{className:"text-right font-semibold text-gray-700",children:l.length})]})})]})})]})})}function Qe(){const{open:s,setOpen:t,currentRow:i,setCurrentRow:a,setCRDName:l}=D();return e.jsx(e.Fragment,{children:i&&e.jsx($e,{open:s==="detail",onOpenChange:()=>{t(null),l(void 0),setTimeout(()=>{a(null)},500)},CRDName:i==null?void 0:i.name},"CRD-detail")})}function We(){const[s,t]=d.useState([]),i=async()=>{try{const a=await V.get("/api/gvr/all"),l=[];a.data.apiresourceListSlice.forEach(r=>{r.resources.forEach(o=>{const n=r.groupVersion.split("/")[0],p=r.apiVersion,w=o.kind,C=o.name,g=o.namespaced,N=o.singularName,m=o.shortNames||[];l.push({group:n,version:p,kind:w,name:C,namespaced:g,singularName:N,shortNames:m,verbs:o.verbs})})}),a.data.apigroup.forEach(r=>{if(r.name!==""){const o=r.name,n=r.preferredVersion.version;l.push({group:o,version:n,kind:"",name:r.name,namespaced:"",singularName:"",shortNames:[],verbs:[]})}}),t(l)}catch(a){M({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(a,null,2)})})})}};return d.useEffect(()=>{i();const a=setInterval(i,1e4);return()=>clearInterval(a)},[]),e.jsxs(Ke,{children:[e.jsxs(re,{fixed:!0,children:[e.jsx(ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(le,{}),e.jsx(ie,{})]})]}),e.jsxs(oe,{children:[e.jsx("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"自定义资源"}),e.jsx("p",{className:"text-muted-foreground",children:"查看所有自定义资源"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Je,{data:s,columns:Oe,fetchData:i})})]}),e.jsx(Qe,{})]})}const ns=ce("/_authenticated/crds/")({component:We});export{ns as Route};
