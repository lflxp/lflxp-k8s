import{j as e,d as F,Q as ne,R as Ce,B as f,V as le,W as _,X as de,r as N,Y as ce,D as ye,E as be,J as Se,K as De,ag as Te,ah as Me,ai as ke,s as Ie,_ as G,a9 as Pe,aa as Ae,ab as Oe,ac as Fe,ad as Z,ae as W,af as Ee,I as E,b as Je,t as Be,z as w,$ as Ve,a0 as ze,a1 as He,a2 as $e,a3 as Qe,F as Ue,e as _e,f as Ge,g as Ke,h as Le,i as qe,a4 as Xe,a8 as Ye,a5 as g,ao as re,ap as oe,aq as me,ar as he,as as xe,at as pe,au as je,aD as Ze,a7 as R,aE as M,C as J,ax as B,ay as V,az as z,aA as H,aG as We,aH as we,aI as A,aJ as K,aK as L,aL as O,H as Re,p as ea,T as aa,q as sa,M as ta,c as ia}from"./index-DZ15lEjL.js";import{C as ee}from"./checkbox-CZbUt50f.js";import{A as ae,a as se,C as na,E as la,b as da,c as ca,d as ra,e as oa,M as ma,P as ha,f as xa,g as pa}from"./react-icons.esm-YVr7mMhs.js";import{u as ja,C as ga}from"./confirm-dialog-BplCbJmN.js";import{u as fa,T as $,a as Q,b as T,c as k,f as te,d as U,e as C,g as Na,h as va,i as ua,j as Ca,k as ya,l as ba,m as Sa}from"./table-w9-QDBI0.js";import{S as Da,a as Ta,b as Ma,c as ka,d as Ia}from"./select-Bem2LIrj.js";import{P as Pa,a as Aa,b as Oa}from"./popover-DF9z8A43.js";import{I as Fa}from"./IconDownload-CbknxLXr.js";import{I as Ea}from"./IconPlus-Bh6cT2i5.js";import{T as q}from"./textarea-BkdDppiV.js";import{D as X,a as Y}from"./drawer-z8KdF3Ex.js";import"./chart-DWZMGOuF.js";import{J as ge}from"./main-Dii-a-Sr.js";import"./index-CKxYrwxP.js";function I({column:a,title:t,className:s}){return a.getCanSort()?e.jsx("div",{className:F("flex items-center space-x-2",s),children:e.jsxs(ne,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(f,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:t}),a.getIsSorted()==="desc"?e.jsx(ae,{className:"ml-2 h-4 w-4"}):a.getIsSorted()==="asc"?e.jsx(se,{className:"ml-2 h-4 w-4"}):e.jsx(na,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(le,{align:"start",children:[e.jsxs(_,{onClick:()=>a.toggleSorting(!1),children:[e.jsx(se,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(_,{onClick:()=>a.toggleSorting(!0),children:[e.jsx(ae,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),a.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(de,{}),e.jsxs(_,{onClick:()=>a.toggleVisibility(!1),children:[e.jsx(la,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:F(s),children:t})}const fe=ce.createContext(null);function Ja({children:a}){const[t,s]=ja(null),[i,l]=N.useState(null),[n,d]=N.useState(void 0);return e.jsx(fe,{value:{open:t,setOpen:s,currentRow:i,setCurrentRow:l,containerName:n,setContainerName:d},children:a})}const P=()=>{const a=ce.useContext(fe);if(!a)throw new Error("useTasks has to be used within <PodsContext>");return a},Ba=[{id:"select",header:({table:a})=>e.jsx(ee,{checked:a.getIsAllPageRowsSelected()||a.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>a.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),cell:({row:a})=>e.jsx(ee,{checked:a.getIsSelected(),onCheckedChange:t=>a.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:a})=>e.jsx(I,{column:a,title:"名称"}),cell:({row:a})=>{var l;const{setOpen:t,setCurrentRow:s}=P(),i=()=>{t("detail"),s(a.original)};return e.jsx("div",{children:e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap hover:overflow-visible hover:text-blue-600 cursor-pointer",onClick:i,children:(l=a.original)==null?void 0:l.name})})},enableSorting:!1,enableHiding:!1},{accessorKey:"namespace",header:({column:a})=>e.jsx(I,{column:a,title:"命名空间"}),cell:({row:a})=>{var t;return e.jsx("div",{className:"w-fit",children:(t=a.original)==null?void 0:t.namespace})}},{accessorKey:"data",header:({column:a})=>e.jsx(I,{column:a,title:"Data"}),cell:({row:a})=>{var t,s;return e.jsx("div",{className:"w-fit",children:(s=(t=a.original)==null?void 0:t.crd)!=null&&s.data?Object.keys(a.original.crd.data).length:"0"})}},{accessorKey:"capatibility",header:({column:a})=>e.jsx(I,{column:a,title:"大小"}),cell:({row:a})=>{var t,s;return e.jsx("div",{className:"w-fit",children:(s=(t=a.original)==null?void 0:t.crd)!=null&&s.data?(()=>{const i=Object.values(a.original.crd.data).reduce((l,n)=>l+((n==null?void 0:n.length)||0),0);return i>=1024*1024?(i/(1024*1024)).toFixed(2)+" MB":i>=1024?(i/1024).toFixed(2)+" KB":i+" bytes"})():"0 bytes"})}},{accessorKey:"owner",header:({column:a})=>e.jsx(I,{column:a,title:"OwnerReferences"}),cell:({row:a})=>{var s,i,l;const t=(l=(i=(s=a.original)==null?void 0:s.crd)==null?void 0:i.metadata)==null?void 0:l.ownerReferences;return!t||t.length===0?"-":e.jsx(ye,{children:e.jsxs(be,{children:[e.jsx(Se,{className:"w-fit",children:t.map((n,d)=>e.jsx("div",{className:"text-ellipsis overflow-hidden whitespace-nowrap hover:overflow-visible hover:text-blue-600 cursor-pointer",children:`${n.kind}/${n.name}`},d))}),e.jsx(De,{children:t.map((n,d)=>e.jsx("div",{children:`${n.kind}/${n.name}`},d))})]})})}},{accessorKey:"createtime",header:({column:a})=>e.jsx(I,{column:a,title:"运行时间"}),cell:({row:a})=>{var j;const t=c=>{const o=Date.now()-c,p=24*3600*1e3,x=3600*1e3,v=60*1e3,y=Math.floor(o/p),u=o%p,b=Math.floor(u/x),D=u%x,Ne=Math.floor(D/v),ve=D%v,ue=Math.round(ve/1e3);return{days:y,hours:b,minutes:Ne,seconds:ue}},s=(c,h,o,p)=>{let x="";return c>0&&(x+=`${c}d `),h>0&&(x+=`${h}h `),o>0&&(x+=`${o}m `),p>0&&(x+=`${p}s`),x},i=new Date(((j=a.original.crd.metadata)==null?void 0:j.creationTimestamp)||"").getTime(),{days:l,hours:n,minutes:d,seconds:r}=t(i),m=s(l,n,d,r);return e.jsx("div",{className:"w-fit",children:m})}}];function Va({table:a}){return e.jsxs("div",{className:"flex items-center justify-between overflow-clip px-2",style:{overflowClipMargin:1},children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[a.getFilteredSelectedRowModel().rows.length," of"," ",a.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(Da,{value:`${a.getState().pagination.pageSize}`,onValueChange:t=>{a.setPageSize(Number(t))},children:[e.jsx(Ta,{className:"h-8 w-[70px]",children:e.jsx(Ma,{placeholder:a.getState().pagination.pageSize})}),e.jsx(ka,{side:"top",children:[5,10,20,30,40,50].map(t=>e.jsx(Ia,{value:`${t}`,children:t},t))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",a.getState().pagination.pageIndex+1," of"," ",a.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(f,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(0),disabled:!a.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(da,{className:"h-4 w-4"})]}),e.jsxs(f,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.previousPage(),disabled:!a.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(ca,{className:"h-4 w-4"})]}),e.jsxs(f,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.nextPage(),disabled:!a.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(ra,{className:"h-4 w-4"})]}),e.jsxs(f,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(a.getPageCount()-1),disabled:!a.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(oa,{className:"h-4 w-4"})]})]})]})]})}function za({table:a}){return e.jsxs(ne,{modal:!1,children:[e.jsx(Te,{asChild:!0,children:e.jsxs(f,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(ma,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(le,{align:"end",className:"w-[150px]",children:[e.jsx(Me,{children:"Toggle columns"}),e.jsx(de,{}),a.getAllColumns().filter(t=>typeof t.accessorFn<"u"&&t.getCanHide()).map(t=>e.jsx(ke,{className:"capitalize",checked:t.getIsVisible(),onCheckedChange:s=>t.toggleVisibility(!!s),children:t.id},t.id))]})]})}function Ha({column:a,title:t,options:s}){const i=a==null?void 0:a.getFacetedUniqueValues(),l=new Set(a==null?void 0:a.getFilterValue());return e.jsxs(Pa,{children:[e.jsx(Aa,{asChild:!0,children:e.jsxs(f,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(ha,{className:"mr-2 h-4 w-4"}),t,(l==null?void 0:l.size)>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ie,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):s.filter(n=>l.has(n.value)).map(n=>e.jsx(G,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:n.label},n.value))})]})]})}),e.jsx(Oa,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Pe,{children:[e.jsx(Ae,{placeholder:t}),e.jsxs(Oe,{children:[e.jsx(Fe,{children:"No results found."}),e.jsx(Z,{children:s.map(n=>{const d=l.has(n.value);return e.jsxs(W,{onSelect:()=>{d?l.delete(n.value):l.add(n.value);const r=Array.from(l);a==null||a.setFilterValue(r.length?r:void 0)},children:[e.jsx("div",{className:F("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",d?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(xa,{className:F("h-4 w-4")})}),n.icon&&e.jsx(n.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:n.label}),(i==null?void 0:i.get(n.value))&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:i.get(n.value)})]},n.value)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ee,{}),e.jsx(Z,{children:e.jsx(W,{onSelect:()=>a==null?void 0:a.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const $a=({fetchData:a})=>{const{setOpen:t}=P();return e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{variant:"outline",className:"space-x-1",onClick:()=>t("import"),children:[e.jsx("span",{children:"Import"})," ",e.jsx(Fa,{size:18})]}),e.jsxs(f,{className:"space-x-1",variant:"outline",onClick:()=>t("create"),children:[e.jsx("span",{children:"Create"})," ",e.jsx(Ea,{size:18})]}),e.jsx(f,{onClick:a,variant:"outline",children:"刷新"})]})};function Qa({table:a,originalData:t,fetchData:s}){var n;const i=a.getState().columnFilters.length>0,l=[...new Set(t.map(d=>{var r;return(r=d.crd)==null?void 0:r.metadata.namespace}))].map(d=>({value:d,label:d}));return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(E,{placeholder:"Filter tasks...",value:((n=a.getColumn("name"))==null?void 0:n.getFilterValue())??"",onChange:d=>{var r;return(r=a.getColumn("name"))==null?void 0:r.setFilterValue(d.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsx("div",{className:"flex gap-x-2",children:a.getColumn("namespace")&&e.jsx(Ha,{column:a.getColumn("namespace"),title:"命名空间筛选",options:l})}),i&&e.jsxs(f,{variant:"ghost",onClick:()=>a.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(pa,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(za,{table:a}),e.jsx($a,{fetchData:s})]})}function Ua({columns:a,data:t,fetchData:s}){var o;const[i,l]=N.useState({}),[n,d]=N.useState({}),[r,m]=N.useState([]),[j,c]=N.useState([]),h=fa({data:t,columns:a,state:{sorting:j,columnVisibility:n,rowSelection:i,columnFilters:r},enableRowSelection:!0,onRowSelectionChange:l,onSortingChange:c,onColumnFiltersChange:m,onColumnVisibilityChange:d,getCoreRowModel:ba(),getFilteredRowModel:ya(),getPaginationRowModel:Ca(),getSortedRowModel:ua(),getFacetedRowModel:va(),getFacetedUniqueValues:Na()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Qa,{table:h,originalData:t,fetchData:s}),e.jsx("div",{className:"rounded-md border",children:e.jsxs($,{children:[e.jsx(Q,{children:h.getHeaderGroups().map(p=>e.jsx(T,{children:p.headers.map(x=>e.jsx(k,{colSpan:x.colSpan,children:x.isPlaceholder?null:te(x.column.columnDef.header,x.getContext())},x.id))},p.id))}),e.jsx(U,{children:(o=h.getRowModel().rows)!=null&&o.length?h.getRowModel().rows.map(p=>e.jsx(T,{"data-state":p.getIsSelected()&&"selected",children:p.getVisibleCells().map(x=>e.jsx(C,{children:te(x.column.columnDef.cell,x.getContext())},x.id))},p.id)):e.jsx(T,{children:e.jsx(C,{colSpan:a.length,className:"h-24 text-center",children:"No results."})})})]})}),e.jsx(Va,{table:h})]})}const _a=w.object({file:w.instanceof(FileList).refine(a=>a.length>0,{message:"Please upload a file"}).refine(a=>{var t;return["text/csv"].includes((t=a==null?void 0:a[0])==null?void 0:t.type)},"Please upload csv format.")});function Ga({open:a,onOpenChange:t}){const s=Je({resolver:Be(_a),defaultValues:{file:void 0}}),i=s.register("file"),l=()=>{const n=s.getValues("file");if(n&&n[0]){const d={name:n[0].name,size:n[0].size,type:n[0].type};g({title:"You have imported the following file:",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(d,null,2)})})})}t(!1)};return e.jsx(Ve,{open:a,onOpenChange:n=>{t(n),s.reset()},children:e.jsxs(ze,{className:"gap-2 sm:max-w-sm",children:[e.jsxs(He,{className:"text-left",children:[e.jsx($e,{children:"Import Tasks"}),e.jsx(Qe,{children:"Import tasks quickly from a CSV file."})]}),e.jsx(Ue,{...s,children:e.jsx("form",{id:"task-import-form",onSubmit:s.handleSubmit(l),children:e.jsx(_e,{control:s.control,name:"file",render:()=>e.jsxs(Ge,{className:"mb-2 space-y-1",children:[e.jsx(Ke,{children:"File"}),e.jsx(Le,{children:e.jsx(E,{type:"file",...i,className:"h-8"})}),e.jsx(qe,{})]})})})}),e.jsxs(Xe,{className:"gap-2 sm:gap-0",children:[e.jsx(Ye,{asChild:!0,children:e.jsx(f,{variant:"outline",children:"Close"})}),e.jsx(f,{type:"submit",form:"task-import-form",children:"Import"})]})]})})}const Ka={apiVersion:"v1",kind:"ConfigMap",metadata:{annotations:{"cni.projectcalico.org/containerID":"6952a74e0b1c95f958e0e40eb2c8a8d93430112f2fc1860f2e81aa4d439d48e2","cni.projectcalico.org/podIP":"10.42.153.106/32","cni.projectcalico.org/podIPs":"10.42.153.106/32"},creationTimestamp:"2025-03-25T14:09:59Z",generateName:"demo-7fdf7d479b-",labels:{aa:"bbcd","app.kubernetes.io/instance":"demo","app.kubernetes.io/managed-by":"Helm","app.kubernetes.io/name":"demo","app.kubernetes.io/version":"1.16.0","helm.sh/chart":"demo-0.1.0","pod-template-hash":"7fdf7d479b"},name:"demo-7fdf7d479b-g52kv",namespace:"default"},data:{"ca.crt":`-----BEGIN CERTIFICATE-----
MIIBeDCCAR+gAwIBAgIBADAKBggqhkjOPQQDAjAkMSIwIAYDVQQDDBlya2UyLXNl
cnZlci1jYUAxNzI5NTE3MDg2MB4XDTI0MTAyMTEzMjQ0NloXDTM0MTAxOTEzMjQ0
NlowJDEiMCAGA1UEAwwZcmtlMi1zZXJ2ZXItY2FAMTcyOTUxNzA4NjBZMBMGByqG
SM49AgEGCCqGSM49AwEHA0IABNKBzAGXLrClfDtJiqdWcQXRjazRk2Y07Xr1mTPX
GhNMJzZJZTrYMdbKQxreqDZuMk2YW17wRQAd/siTNViQ9hOjQjBAMA4GA1UdDwEB
/wQEAwICpDAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBRrtYwH+oUGoWFwYB02
BZHErOVJ7DAKBggqhkjOPQQDAgNHADBEAiAEQzDeiTNdp1rwwdoPlshuGe6aiau+
MKcs+FgeBI8XJQIgGIsQ9C5sMUjM72VQMEIyiX3ZrM5Q3A35+upuHxPaop8=
-----END CERTIFICATE-----
`}};function ie({open:a,onOpenChange:t,currentRow:s}){const i=!!s,[l,n]=N.useState(""),[d,r]=N.useState(""),[m,j]=N.useState(!1);N.useEffect(()=>{s!=null&&s.raw&&n(JSON.stringify(s.raw,null,2)),r(JSON.stringify(Ka,null,2))},[s]);const c=()=>{try{if(!(s!=null&&s.namespace)||!(s!=null&&s.name)){g({title:"更新失败",description:"缺少必要的Pod信息",variant:"destructive"});return}const o={group:"",version:"v1",resource:"configmaps",namespace:s.namespace,name:s.name,data:JSON.parse(l)};fetch("/api/gvr",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}).then(p=>{if(!p.ok)throw new Error("更新失败");return p.json()}).then(p=>{g({title:"更新成功",description:"Pod配置已更新"}),t(!1)}).catch(p=>{g({title:"更新失败",description:"请检查网络连接或联系管理员",variant:"destructive"})})}catch{g({title:"JSON格式错误",description:"请检查JSON格式是否正确",variant:"destructive"})}},h=()=>{try{const o=JSON.parse(d);o.metadata.name===""&&g({title:"缺少必要条件",description:"metdata.name 不能为空"});const p={group:"",version:"v1",resource:"configmaps",namespace:o.metadata.namespace===""?"default":o.metadata.namespace,name:o.metadata.name,data:o};fetch("/api/gvr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}).then(x=>{if(!x.ok)throw new Error("新增失败");return x.json()}).then(x=>{g({title:"新增成功",description:"Pod配置已新增"}),t(!1)}).catch(x=>{g({title:"新增失败",description:"请检查网络连接或联系管理员",variant:"destructive"})})}catch{g({title:"JSON格式错误",description:"请检查JSON格式是否正确",variant:"destructive"})}};return e.jsx(re,{open:a,onOpenChange:o=>{t(o)},children:e.jsxs(oe,{side:"right",className:"w-[50%] sm:max-w-[90%] flex flex-col overflow-y-auto",children:[e.jsxs(me,{className:"text-left",children:[e.jsxs(he,{children:[i?"更新":"创建"," Pod"]}),e.jsx(xe,{children:i?"更新Pod配置信息":"创建新的Pod配置"})]}),i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx(f,{variant:"outline",onClick:()=>j(!m),children:m?"切换到视图模式":"切换到编辑模式"})}),m?e.jsx(q,{value:l,onChange:o=>n(o.target.value),className:"flex-1 font-mono resize-none",placeholder:"请输入JSON数据..."}):e.jsx(ge,{src:(s==null?void 0:s.raw)||{},enableClipboard:!0,displayDataTypes:!1,name:!1})]}):e.jsx(q,{value:d,onChange:o=>{r(o.target.value)},className:"flex-1 font-mono resize-none",placeholder:"请输入Pod配置..."}),e.jsxs(pe,{className:"gap-2 mt-4",children:[e.jsx(je,{asChild:!0,children:e.jsx(f,{variant:"outline",children:"关闭"})}),i?m&&e.jsx(f,{form:"tasks-form",onClick:c,children:"更新配置"}):e.jsx(f,{form:"tasks-form",onClick:h,children:"新建"})]})]})})}function La({open:a,onOpenChange:t,podName:s,namespace:i,containerName:l}){const n=`/ws/logs/html/${i}/${s}/${l}`;return e.jsx(X,{open:a,onOpenChange:t,children:e.jsx(Y,{className:"h-[80vh] mt-0",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("iframe",{src:n,className:"w-full h-full rounded-md border",style:{minHeight:"500px"}})})})})}function qa({open:a,onOpenChange:t,podName:s,namespace:i,containerName:l}){const n=`/ws/ssh/html/${i}/${s}/${l}`;return e.jsx(X,{open:a,onOpenChange:t,children:e.jsx(Y,{className:"h-[80vh] mt-0",children:e.jsx("div",{className:"w-full h-full",children:e.jsx("iframe",{src:n,className:"w-full h-full rounded-md",style:{minHeight:"500px"}})})})})}function S({types:a,kind:t,name:s,namespace:i,keys:l,values:n}){const{currentRow:d,setCurrentRow:r}=P(),[m,j]=N.useState(""),[c,h]=N.useState(""),o=async()=>{if(!c||!m){g({title:"键或值不能为空",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:c,value:m},null,2)})})});return}try{if(t==="label"){const v=await M.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"configmaps",name:s,namespace:i,patchdatastrate:{metadata:{labels:{[c]:m}}}}),y={...d,crd:v.data};r(y)}else if(t==="annotation"){const v=await M.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"configmaps",name:s,namespace:i,patchdatastrate:{metadata:{annotations:{[c]:m}}}}),y={...d,crd:v.data};r(y)}else if(t==="data"){const v=await M.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"configmaps",name:s,namespace:i,patchdatastrate:{data:{[c]:m}}}),y={...d,crd:v.data};r(y)}g({title:"请求成功",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:c,value:m},null,2)})})})}catch(v){g({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(v,null,2)})})})}},p=async()=>{var v,y;if(!c){g({title:"键不能为空",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:c},null,2)})})});return}if(window.confirm(`确定要删除键 ${c} 吗？`))try{if(t==="label"){const u={...d};(v=u.metadata)!=null&&v.labels&&delete u.metadata.labels[c];const b=await M.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"configmaps",name:s,namespace:i,patchdatastrate:{metadata:{labels:{[c]:null}}}}),D={...d,crd:b.data};r(D)}else if(t==="annotation"){const u={...d};(y=u.metadata)!=null&&y.annotations&&delete u.metadata.annotations[c];const b=await M.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"configmaps",name:s,namespace:i,patchdatastrate:{metadata:{annotations:{[c]:null}}}}),D={...d,crd:b.data};r(D)}else if(t==="data"){const u={...d};u.data&&delete u.data[c];const b=await M.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"configmaps",name:s,namespace:i,patchdatastrate:{data:{[c]:null}}}),D={...d,crd:b.data};r(D)}g({title:"删除成功",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:c,value:m},null,2)})})})}catch(u){g({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(u,null,2)})})})}};N.useEffect(()=>{j(n),h(l)},[n,l]);const x=()=>{a==="add"||a==="edit"?o():a==="delete"&&p()};return e.jsxs(re,{children:[e.jsx(Ze,{asChild:!0,children:a==="edit"?e.jsx(f,{size:"sm",variant:"link",className:"w-20 text-blue-300 hover:text-blue-500",onClick:o,children:"编辑"}):a==="delete"?e.jsx(f,{size:"sm",variant:"link",className:"w-20 text-red-300 hover:text-red-500",onClick:p,children:"删除"}):a==="add"?e.jsx(f,{size:"sm",variant:"link",className:"w-20 text-green-300 hover:text-green-500",onClick:o,children:"添加"}):null}),e.jsxs(oe,{side:"top",children:[e.jsxs(me,{children:[e.jsxs(he,{children:[a==="edit"?"编辑":a==="add"?"添加":a==="delete"?"删除":null," 节点 ",s," ",t==="label"?"标签":t==="annotation"?"注释":""]}),e.jsxs(xe,{children:["新增节点 ",s," ",t==="label"?"标签":t==="annotation"?"注释":"","，请填写相关信息。",a==="edit"?"编辑节点":a==="add"?"添加节点":a==="delete"?"删除节点":null," ",s," ",t==="label"?"标签":t==="annotation"?"注释":"","，请填写相关信息。"]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(R,{htmlFor:"name",className:"text-right",children:"键"}),e.jsx(E,{id:"name",value:c,disabled:a!=="add",onChange:v=>h(v.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(R,{htmlFor:"username",className:"text-right",children:"值"}),e.jsx(E,{id:"username",value:m,onChange:v=>j(v.target.value),className:"col-span-3"})]})]}),e.jsx(pe,{children:e.jsx(je,{asChild:!0,children:e.jsx(f,{type:"submit",onClick:x,children:"提交"})})})]})]})}function Xa({currentRow:a}){const t=N.useMemo(()=>!a||!a.crd||!a.crd.data?[]:Object.entries(a.crd.data).map(([i,l])=>{var n,d,r,m,j,c,h,o;return e.jsxs(T,{children:[e.jsx(C,{className:"font-medium",children:i}),e.jsx(C,{className:"font-medium",children:l}),e.jsx(C,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{types:"edit",kind:"data",name:((d=(n=a==null?void 0:a.crd)==null?void 0:n.metadata)==null?void 0:d.name)||"",namespace:((m=(r=a==null?void 0:a.crd)==null?void 0:r.metadata)==null?void 0:m.namespace)||"",keys:i,values:typeof l=="string"?l:""}),e.jsx(S,{types:"delete",kind:"data",name:((c=(j=a==null?void 0:a.crd)==null?void 0:j.metadata)==null?void 0:c.name)||"",namespace:((o=(h=a==null?void 0:a.crd)==null?void 0:h.metadata)==null?void 0:o.namespace)||"",keys:i,values:typeof l=="string"?l:""})]})})]},`${i}`)}),[a]),s=N.useMemo(()=>!a||!a.crd||!a.crd.binaryData?[]:Object.entries(a.crd.binaryData).map(([i,l])=>{var n,d,r,m,j,c,h,o;return e.jsxs(T,{children:[e.jsx(C,{className:"font-medium",children:i}),e.jsx(C,{className:"font-medium",children:l}),e.jsx(C,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{types:"edit",kind:"data",name:((d=(n=a==null?void 0:a.crd)==null?void 0:n.metadata)==null?void 0:d.name)||"",namespace:((m=(r=a==null?void 0:a.crd)==null?void 0:r.metadata)==null?void 0:m.namespace)||"",keys:i,values:typeof l=="string"?l:""}),e.jsx(S,{types:"delete",kind:"data",name:((c=(j=a==null?void 0:a.crd)==null?void 0:j.metadata)==null?void 0:c.name)||"",namespace:((o=(h=a==null?void 0:a.crd)==null?void 0:h.metadata)==null?void 0:o.namespace)||"",keys:i,values:typeof l=="string"?l:""})]})})]},`${i}`)}),[a]);return e.jsxs(J,{children:[e.jsxs(B,{children:[e.jsxs(V,{children:[a==null?void 0:a.crd.metadata.name,e.jsx(S,{types:"add",kind:"data",name:a?a.crd.metadata.name:"",namespace:a?a.crd.metadata.namespace:"",keys:"",values:""})]}),e.jsxs(z,{children:["命名空间：",a==null?void 0:a.crd.metadata.namespace]})]}),e.jsx(H,{className:"space-y-2",children:e.jsxs($,{children:[e.jsx(Sa,{children:"容器详情"}),e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(k,{children:"Name"}),e.jsx(k,{children:"Data"})]})}),e.jsxs(U,{children:[t,s]})]})})]})}function Ya({currentRow:a}){const t=N.useMemo(()=>!a||!a.crd||!a.crd.metadata.labels?[]:Object.entries(a.crd.metadata.labels).map(([s,i])=>{var l,n,d,r,m,j,c,h;return e.jsxs(T,{children:[e.jsx(C,{className:"font-medium",children:s}),e.jsx(C,{children:i}),e.jsx(C,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{types:"edit",kind:"label",name:((n=(l=a==null?void 0:a.crd)==null?void 0:l.metadata)==null?void 0:n.name)||"",namespace:((r=(d=a==null?void 0:a.crd)==null?void 0:d.metadata)==null?void 0:r.namespace)||"",keys:s,values:typeof i=="string"?i:""}),e.jsx(S,{types:"delete",kind:"label",name:((j=(m=a==null?void 0:a.crd)==null?void 0:m.metadata)==null?void 0:j.name)||"",namespace:((h=(c=a==null?void 0:a.crd)==null?void 0:c.metadata)==null?void 0:h.namespace)||"",keys:s,values:typeof i=="string"?i:""})]})})]},s)}),[a]);return e.jsxs(J,{children:[e.jsxs(B,{children:[e.jsxs(V,{children:[a==null?void 0:a.crd.metadata.name,e.jsx(S,{types:"add",kind:"label",name:a?a.crd.metadata.name:"",namespace:a?a.crd.metadata.namespace:"",keys:"",values:""})]}),e.jsxs(z,{children:["命名空间：",a==null?void 0:a.crd.metadata.namespace]})]}),e.jsx(H,{className:"space-y-2",children:e.jsxs($,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(k,{className:"w-[50%]",children:"键"}),e.jsx(k,{className:"w-[50%]",children:"值"})]})}),e.jsx(U,{children:t})]})})]})}function Za({currentRow:a}){const t=N.useMemo(()=>!a||!a.crd||!a.crd.metadata.annotations?[]:Object.entries(a.crd.metadata.annotations).map(([s,i])=>{var l,n,d,r,m,j,c,h;return e.jsxs(T,{children:[e.jsx(C,{className:"font-medium",children:s}),e.jsx(C,{children:i}),e.jsx(C,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(S,{types:"edit",kind:"annotation",name:((n=(l=a==null?void 0:a.crd)==null?void 0:l.metadata)==null?void 0:n.name)||"",namespace:((r=(d=a==null?void 0:a.crd)==null?void 0:d.metadata)==null?void 0:r.namespace)||"",keys:s,values:typeof i=="string"?i:""}),e.jsx(S,{types:"delete",kind:"annotation",name:((j=(m=a==null?void 0:a.crd)==null?void 0:m.metadata)==null?void 0:j.name)||"",namespace:((h=(c=a==null?void 0:a.crd)==null?void 0:c.metadata)==null?void 0:h.namespace)||"",keys:s,values:typeof i=="string"?i:""})]})})]},s)}),[a]);return e.jsxs(J,{children:[e.jsxs(B,{children:[e.jsxs(V,{children:[a==null?void 0:a.crd.metadata.name,e.jsx(S,{types:"add",kind:"annotation",name:a?a.crd.metadata.name:"",namespace:a?a.crd.metadata.namespace:"",keys:"",values:""})]}),e.jsxs(z,{children:["命名空间：",a==null?void 0:a.crd.metadata.namespace]})]}),e.jsx(H,{className:"space-y-2",children:e.jsxs($,{children:[e.jsx(Q,{children:e.jsxs(T,{children:[e.jsx(k,{className:"w-[50%]",children:"键"}),e.jsx(k,{className:"w-[50%]",children:"值"})]})}),e.jsx(U,{children:t})]})})]})}function Wa({open:a,onOpenChange:t,currentRow:s}){var j,c,h,o;const[i,l]=N.useState(!1),[n,d]=N.useState(""),{setCurrentRow:r}=P();N.useEffect(()=>{s!=null&&s.crd&&d(JSON.stringify(s.crd,null,2))},[s]);const m=()=>{var p,x,v,y;try{const u={group:"",version:"v1",resource:"configmaps",namespace:(x=(p=s==null?void 0:s.crd)==null?void 0:p.metadata)==null?void 0:x.namespace,name:(y=(v=s==null?void 0:s.crd)==null?void 0:v.metadata)==null?void 0:y.name,data:i?JSON.parse(n):s==null?void 0:s.crd};fetch("/api/gvr",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u)}).then(b=>b.json()).then(b=>{const D={...s,crd:b.data};r(D),g({title:"更新成功",description:"Deployments配置已更新"})}).catch(b=>{g({title:"更新失败",description:"请检查网络连接或联系管理员",variant:"destructive"})})}catch{g({title:"JSON格式错误",description:"请检查JSON格式是否正确",variant:"destructive"})}};return e.jsx(X,{open:a,onOpenChange:t,children:e.jsx(Y,{children:e.jsxs(We,{defaultValue:"container",className:"w-full",children:[e.jsxs(we,{className:"grid w-full grid-cols-4 gap-2",children:[e.jsxs(A,{value:"container",children:["配置",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx(L,{className:"text-xs",children:Object.keys(s.crd.data||{}).length})})]}),e.jsxs(A,{value:"label",children:["标签",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx(L,{className:"text-xs",children:(c=(j=s==null?void 0:s.crd)==null?void 0:j.metadata)!=null&&c.labels?Object.keys(s.crd.metadata.labels).length:0})})]}),e.jsxs(A,{value:"annotation",children:["注释",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx(L,{className:"text-xs",children:(o=(h=s==null?void 0:s.crd)==null?void 0:h.metadata)!=null&&o.annotations?Object.keys(s.crd.metadata.annotations).length:0})})]}),e.jsx(A,{value:"jsondata",children:"查看或编辑"})]}),e.jsx(O,{value:"label",className:"h-[80vh] overflow-y-auto",children:e.jsx(Ya,{currentRow:s})}),e.jsx(O,{value:"annotation",className:"h-[80vh] overflow-y-auto",children:e.jsx(Za,{currentRow:s})}),e.jsx(O,{value:"container",className:"h-[80vh] overflow-y-auto",children:e.jsx(Xa,{currentRow:s})}),e.jsx(O,{value:"jsondata",className:"h-[80vh] overflow-y-auto",children:e.jsxs(J,{children:[e.jsxs(B,{children:[e.jsx(V,{children:s==null?void 0:s.crd.metadata.name}),e.jsxs(z,{children:["命名空间：",s==null?void 0:s.crd.metadata.namespace]})]}),e.jsxs(H,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-end mb-4",children:[i&&e.jsx(f,{variant:"ghost",onClick:m,children:"更新"}),e.jsx(f,{variant:"outline",onClick:()=>l(!i),children:i?"切换到视图模式":"切换到编辑模式"})]}),i?e.jsx(q,{value:n,onChange:p=>d(p.target.value),className:"min-h-[500px] font-mono",placeholder:"请输入JSON数据..."}):e.jsx(ge,{src:(s==null?void 0:s.crd)||{},enableClipboard:!0,displayDataTypes:!1,name:!1})]})]})})]})})})}function wa(){const{open:a,setOpen:t,currentRow:s,setCurrentRow:i,containerName:l,setContainerName:n}=P(),d=()=>{try{if(!(s!=null&&s.namespace)||!(s!=null&&s.name)){g({title:"更新失败",description:"缺少必要的Pod信息",variant:"destructive"});return}const r={group:"",version:"v1",resource:"pods",namespace:s==null?void 0:s.namespace,name:s==null?void 0:s.name};fetch("/api/gvr",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then(m=>{if(!m.ok)throw new Error("刪除失败");return m.json()}).then(m=>{g({title:"刪除成功",description:"Pod配置已刪除"})}).catch(m=>{g({title:"刪除失败",description:"请检查网络连接或联系管理员",variant:"destructive"})})}catch{g({title:"JSON格式错误",description:"请检查JSON格式是否正确",variant:"destructive"})}};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{open:a==="create",onOpenChange:()=>t("create")},"task-create"),e.jsx(Ga,{open:a==="import",onOpenChange:()=>t("import")},"tasks-import"),s&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{open:a==="update",onOpenChange:()=>{t("update"),setTimeout(()=>{i(null)},500)},currentRow:s},`task-update-${s.id}`),e.jsx(La,{open:a==="terminal",onOpenChange:()=>{t(null),n(void 0),setTimeout(()=>{i(null)},500)},podName:s.name,namespace:s.namespace,containerName:l},`pod-terminal-${s.name}`),e.jsx(Wa,{open:a==="detail",onOpenChange:()=>{t(null),setTimeout(()=>{i(null)},500)},currentRow:s},`pod-detail-${s.name}`),e.jsx(qa,{open:a==="ssh",onOpenChange:()=>{t(null),n(void 0),setTimeout(()=>{i(null)},500)},podName:s.name,namespace:s.namespace,containerName:l},`pod-ssh-${s.name}`),e.jsx(ga,{destructive:!0,open:a==="delete",onOpenChange:()=>{t("delete"),setTimeout(()=>{i(null)},500)},handleConfirm:()=>{t(null),setTimeout(()=>{i(null)},500),d()},name:s.name,namespace:s.namespace,className:"max-w-md",title:`Delete Pod: ${s.namespace}/${s.name} ?`,desc:e.jsxs(e.Fragment,{children:["You are about to delete a Pod with the Name"," ",e.jsxs("strong",{children:[s.namespace,"/",s.name]}),". ",e.jsx("br",{}),"This action cannot be undone."]}),confirmText:"Delete"},"task-delete")]})]})}function Ra(){const[a,t]=N.useState([]),s=async()=>{try{const i=await M.post("/api/gvr/list",{group:"",version:"v1",resource:"configmaps",fast:!0});t(i.data)}catch(i){g({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(i,null,2)})})})}};return N.useEffect(()=>{s()},[]),e.jsxs(Ja,{children:[e.jsxs(Re,{fixed:!0,children:[e.jsx(ea,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(aa,{}),e.jsx(sa,{})]})]}),e.jsx(ta,{children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsx("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"ConfigMap"}),e.jsx("p",{className:"text-muted-foreground",children:"ConfigMap是Kubernetes中用于存储非机密数据的API对象。它允许用户将配置数据分离到独立的对象中，从而使应用程序和服务能够更灵活地使用这些配置。ConfigMap可以存储键值对、文件或目录等数据，并可以在Pod中以环境变量、命令行参数或挂载为文件的方式使用。通过ConfigMap，用户可以轻松地管理和更新应用程序的配置，而无需重新构建镜像或修改代码。"}),e.jsx("p",{className:"text-muted-foreground",children:"通过使用ConfigMap，用户可以将配置与应用程序代码分离，从而实现更好的可维护性和灵活性。ConfigMap支持动态更新，允许在不重启Pod的情况下更新配置。"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0 mr-[1px]",children:e.jsx(Ua,{data:a,columns:Ba,fetchData:s})})]})}),e.jsx(wa,{})]})}const ps=ia("/_authenticated/configmaps/")({component:Ra});export{ps as Route};
