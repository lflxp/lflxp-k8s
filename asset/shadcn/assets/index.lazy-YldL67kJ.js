import{j as e,d as U,Q as X,R as Y,B as I,V as Z,W as B,X as R,r as p,Y as z,aE as F,a5 as N,_ as ee,a7 as L,ao as se,aD as ae,ap as te,aq as ne,ar as le,as as ie,I as V,at as re,au as ce,C as w,ax as O,ay as M,az as D,aA as C,a2 as de,aG as oe,aH as he,aI as S,aJ as $,aK as A,aL as T,H as xe,p as me,T as ue,q as je,M as pe,c as fe}from"./index-Sj8PalxT.js";import{A as W,a as G,C as ge,E as Ne}from"./react-icons.esm-CmOjNWrw.js";import{T as v,d as y,b as m,e as o,u as be,g as ve,a as P,c as j,f as q}from"./table-Y-QFyalC.js";import{D as ye,a as we,b as Ce}from"./drawer-BexXwk-V.js";import{J as Se}from"./main-ugSn7wM5.js";import{R as Te}from"./refresh-cw-CZoVMONF.js";function _({column:s,title:n,className:t}){return s.getCanSort()?e.jsx("div",{className:U("flex items-center space-x-2",t),children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(I,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:n}),s.getIsSorted()==="desc"?e.jsx(W,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(G,{className:"ml-2 h-4 w-4"}):e.jsx(ge,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(Z,{align:"start",children:[e.jsxs(B,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(G,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(B,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(W,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs(B,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(Ne,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:U(t),children:n})}const Q=p.createContext(null);function Fe({children:s}){const[n,t]=z.useState(null),[a,l]=z.useState(null),[i,r]=z.useState(void 0);return e.jsx(Q.Provider,{value:{open:n,setOpen:t,currentRow:a,setCurrentRow:l,nodeName:i,setNodeName:r},children:s})}const E=()=>{const s=p.useContext(Q);if(!s)throw new Error("useNodes must be used within a NodesProvider");return s};function Oe({row:s}){var l,i;const[n,t]=p.useState(s);p.useEffect(()=>{t(s)},[s]);const a=async()=>{var r,c;if(window.confirm(`确定要${(r=n==null?void 0:n.spec)!=null&&r.unschedulable?"恢复调度":"禁止调度"}该节点吗？`))try{if((c=n==null?void 0:n.spec)!=null&&c.unschedulable){const h=await F.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:n==null?void 0:n.metadata.name,patchdatastrate:{spec:{unschedulable:!1}}});console.log("请求接口成功:",h.data),N({title:"恢复操作成功"}),n&&n.spec&&t({...n,spec:{...n.spec,unschedulable:!1}})}else{const h=await F.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:n==null?void 0:n.metadata.name,patchdatastrate:{spec:{unschedulable:!0}}});console.log("请求接口成功:",h.data),N({title:"禁用操作成功"}),s&&s.spec&&t({...n,spec:{...n.spec,unschedulable:!0}})}}catch(h){console.log("请求接口出错:",h),N({title:"操作失败",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(h,null,2)})})})}};return e.jsx(I,{variant:"ghost",className:`flex h-8 w-8 p-0 data-[state=open]:bg-muted ${(l=n==null?void 0:n.spec)!=null&&l.unschedulable?"text-green-400 hover:text-green-600":"text-red-400 hover:text-red-600"}`,onClick:a,children:(i=n==null?void 0:n.spec)!=null&&i.unschedulable?"恢复调度":"禁止调度"})}const Me=[{id:"status",header:"状态",cell:({row:s})=>{var c,h;const n=((h=(c=s.original)==null?void 0:c.status)==null?void 0:h.conditions)||[],t=n.find(d=>d.type==="Ready"),a=n.filter(d=>d.type!=="Ready").every(d=>d.status==="False"),l=t&&t.status==="True"||a?"Active":"警告",i=t&&t.status==="True"||a?"green":"red",r=n.filter(d=>d.type==="Ready"&&d.status==="False"||d.type!=="Ready"&&d.status==="True").map(d=>d.message).join(`
`);return e.jsx("span",{style:{color:i},title:r,children:l})}},{id:"name",header:({column:s})=>e.jsx(_,{column:s,title:"节点名称"}),cell:({row:s})=>{var i,r;const{setOpen:n,setCurrentRow:t}=E(),a=()=>{n("detail"),t(s.original)},l=((r=(i=s.original)==null?void 0:i.metadata)==null?void 0:r.labels)||{};return Object.keys(l).filter(c=>c.startsWith("node-role.kubernetes.io/")).map(c=>c.replace("node-role.kubernetes.io/","")).join(", "),e.jsx("div",{children:e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:a,children:s.original.metadata.name})})},enableSorting:!1,enableHiding:!1},{id:"roles",header:({column:s})=>e.jsx(_,{column:s,title:"角色"}),cell:({row:s})=>{var a,l;const n=((l=(a=s.original)==null?void 0:a.metadata)==null?void 0:l.labels)||{},t=Object.keys(n).filter(i=>i.startsWith("node-role.kubernetes.io/")).map(i=>i.replace("node-role.kubernetes.io/","")).map(i=>e.jsx(ee,{className:"ml-1 bg-green-600",children:i},i));return e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap hover:overflow-visible flex items-center",children:t.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:t}):"-"})},enableSorting:!0,enableHiding:!1},{id:"Kubernetes",header:"Kubernetes",cell:({row:s})=>{var t,a,l;return((l=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.nodeInfo)==null?void 0:l.kubeletVersion)||"N/A"}},{id:"cpu",header:"CPU核数",cell:({row:s})=>{var t,a,l;return((l=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.allocatable)==null?void 0:l.cpu)||"N/A"}},{id:"memory",header:"内存容量",cell:({row:s})=>{var l,i,r;const n=(r=(i=(l=s.original)==null?void 0:l.status)==null?void 0:i.capacity)==null?void 0:r.memory;return(c=>{if(!c)return"0";if(c.endsWith("Ki")){const h=parseFloat(c);if(h>1024){const d=h/1024;return d>1024?`${(d/1024).toFixed(0)} Gi`:`${d.toFixed(0)} Mi`}else return`${h.toFixed(0)} Ki`}if(c.endsWith("Mi")){const h=parseFloat(c);return h>1024?`${(h/1024).toFixed(0)} Gi`:`${h.toFixed(0)} Mi`}return c})(n||"")||"N/A"}},{accessorKey:"pods",header:"Pod数量",cell:({row:s})=>{var t,a,l;return((l=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.allocatable)==null?void 0:l.pods)||"N/A"}},{accessorKey:"creationTimestamp",header:"运行时间",cell:({row:s})=>{var c;const n=(c=s.original.metadata)==null?void 0:c.creationTimestamp;if(!n)return"N/A";const t=Date.now()-new Date(n).getTime(),a=Math.floor(t/1e3),l=Math.floor(a/60),i=Math.floor(l/60),r=Math.floor(i/24);return r>0?`${r}d`:i>0?`${i}h`:l>0?`${l}m`:`${a}s`}},{id:"ip",header:"IP地址",cell:({row:s})=>{var t,a,l;return(((l=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.addresses)==null?void 0:l.filter(i=>i.type==="InternalIP"))||[]).map(i=>e.jsx(L,{className:"text-blue-600",children:i.address},i.type))}},{accessorKey:"cpuUsage",header:"CPU使用率",cell:({row:s})=>{var n,t,a,l,i;try{const r=(a=(t=(n=s.original)==null?void 0:n.status)==null?void 0:t.allocatable)==null?void 0:a.cpu,c=(l=s.original)==null?void 0:l.metrics,h=(i=c==null?void 0:c.usage)==null?void 0:i.cpu,d=x=>x?x.endsWith("m")?parseFloat(x)/1e3:x.endsWith("n")?parseFloat(x)/1e9:parseFloat(x):0,b=d(r),g=d(h),u=b&&g?g/b*100:null;return u?e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"w-full h-6 rounded-full border border-gray-200 bg-gray-100 overflow-hidden relative",children:[e.jsx("div",{className:`h-full transition-all duration-300 absolute top-0 left-0 ${u<30?"bg-green-400":u<60?"bg-yellow-400":u<80?"bg-orange-400":"bg-red-500"}`,style:{width:`${u}%`}}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800 z-10",children:[u.toFixed(2),"%"]})]})}):"N/A"}catch(r){N({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(r,null,2)})})})}}},{accessorKey:"memoryUsage",header:"内存使用率",cell:({row:s})=>{var n,t,a,l,i;try{const r=(a=(t=(n=s==null?void 0:s.original)==null?void 0:n.status)==null?void 0:t.allocatable)==null?void 0:a.memory,c=(l=s==null?void 0:s.original)==null?void 0:l.metrics,h=(i=c==null?void 0:c.usage)==null?void 0:i.memory,d=x=>x?x.endsWith("Ki")?parseFloat(x)*1024:x.endsWith("Mi")?parseFloat(x)*1024*1024:x.endsWith("Gi")?parseFloat(x)*1024*1024*1024:parseFloat(x):0,b=d(r),g=d(h),u=b&&g?g/b*100:null;return u?e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"w-full h-6 rounded-full border border-gray-200 bg-gray-100 overflow-hidden relative",children:[e.jsx("div",{className:`h-full transition-all duration-300 absolute top-0 left-0 ${u<30?"bg-green-400":u<60?"bg-yellow-400":u<80?"bg-orange-400":"bg-red-500"}`,style:{width:`${u}%`}}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800 z-10",children:[u.toFixed(2),"%"]})]})}):"N/A"}catch(r){N({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(r,null,2)})})})}}},{id:"actions",header:"操作",cell:({row:s})=>e.jsx(Oe,{row:s.original})}];function De({columns:s,data:n}){var a;if(!s||!n)return e.jsx("div",{className:"rounded-md border",children:e.jsx(v,{children:e.jsx(y,{children:e.jsx(m,{children:e.jsx(o,{colSpan:(s==null?void 0:s.length)||0,className:"h-24 text-center",children:"没有数据"})})})})});const t=be({data:n,columns:s,getCoreRowModel:ve()});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(v,{children:[e.jsx(P,{children:t.getHeaderGroups().map(l=>e.jsx(m,{children:l.headers.map(i=>e.jsx(j,{children:i.isPlaceholder?null:q(i.column.columnDef.header,i.getContext())},i.id))},l.id))}),e.jsx(y,{children:(a=t.getRowModel().rows)!=null&&a.length?t.getRowModel().rows.map(l=>e.jsx(m,{"data-state":l.getIsSelected()&&"selected",children:l.getVisibleCells().map(i=>e.jsx(o,{children:q(i.column.columnDef.cell,i.getContext())},i.id))},l.id)):e.jsx(m,{children:e.jsx(o,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})})}function Ke({columns:s,data:n}){return e.jsx(De,{columns:s,data:n})}function k({types:s,kind:n,name:t,keys:a,values:l}){const{currentRow:i,setCurrentRow:r}=E(),[c,h]=p.useState(""),[d,b]=p.useState(""),g=async()=>{if(!d||!c){N({title:"键或值不能为空",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d,value:c},null,2)})})});return}try{if(n==="label"){const f=await F.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{labels:{[d]:c}}}});r(f.data)}else if(n==="annotation"){const f=await F.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{annotations:{[d]:c}}}});r(f.data)}N({title:"请求成功",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d,value:c},null,2)})})})}catch(f){N({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(f,null,2)})})})}},u=async()=>{var f,H;if(!d){N({title:"键不能为空",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d},null,2)})})});return}if(window.confirm(`确定要删除键 ${d} 吗？`))try{if(n==="label"){const K={...i};(f=K.metadata)!=null&&f.labels&&delete K.metadata.labels[d];const J=await F.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{labels:{[d]:null}}}});r(J.data)}else if(n==="annotation"){const K={...i};(H=K.metadata)!=null&&H.annotations&&delete K.metadata.annotations[d];const J=await F.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{annotations:{[d]:null}}}});r(J.data)}N({title:"删除成功",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d,value:c},null,2)})})})}catch(K){N({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(K,null,2)})})})}};p.useEffect(()=>{h(l),b(a)},[l,a]);const x=()=>{s==="add"||s==="edit"?g():s==="delete"&&u()};return e.jsxs(se,{children:[e.jsx(ae,{asChild:!0,children:s==="edit"?e.jsx(I,{size:"sm",variant:"link",className:"w-20 text-blue-300 hover:text-blue-500",onClick:g,children:"编辑"}):s==="delete"?e.jsx(I,{size:"sm",variant:"link",className:"w-20 text-red-300 hover:text-red-500",onClick:u,children:"删除"}):s==="add"?e.jsx(I,{size:"sm",variant:"link",className:"w-20 text-green-300 hover:text-green-500",onClick:g,children:"添加"}):null}),e.jsxs(te,{side:"top",children:[e.jsxs(ne,{children:[e.jsxs(le,{children:[s==="edit"?"编辑":s==="add"?"添加":s==="delete"?"删除":null," 节点 ",t," ",n==="label"?"标签":n==="annotation"?"注释":""]}),e.jsxs(ie,{children:["新增节点 ",t," ",n==="label"?"标签":n==="annotation"?"注释":"","，请填写相关信息。",s==="edit"?"编辑节点":s==="add"?"添加节点":s==="delete"?"删除节点":null," ",t," ",n==="label"?"标签":n==="annotation"?"注释":"","，请填写相关信息。"]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(L,{htmlFor:"name",className:"text-right",children:"键"}),e.jsx(V,{id:"name",value:d,disabled:s!=="add",onChange:f=>b(f.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(L,{htmlFor:"username",className:"text-right",children:"值"}),e.jsx(V,{id:"username",value:c,onChange:f=>h(f.target.value),className:"col-span-3"})]})]}),e.jsx(re,{children:e.jsx(ce,{asChild:!0,children:e.jsx(I,{type:"submit",onClick:x,children:"提交"})})})]})]})}function $e(){const{currentRow:s}=E(),n=p.useMemo(()=>!s||!s.metadata.labels?[]:Object.entries(s.metadata.labels).map(([t,a])=>{var l,i;return e.jsxs(m,{children:[e.jsx(o,{className:"font-medium",children:t}),e.jsx(o,{children:a}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{types:"edit",kind:"label",name:((l=s==null?void 0:s.metadata)==null?void 0:l.name)||"",keys:t,values:typeof a=="string"?a:""}),e.jsx(k,{types:"delete",kind:"label",name:((i=s==null?void 0:s.metadata)==null?void 0:i.name)||"",keys:t,values:typeof a=="string"?a:""})]})})]},t)}),[s]);return e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(M,{children:["Labels",e.jsx(k,{types:"add",kind:"label",name:s?s.metadata.name:"",keys:"",values:""})]}),e.jsx(D,{children:"Labels是Kubernetes中用于标识资源的字段。它们通常用于标识资源的类型、状态、版本等。 Labels可以是任意的键值对，它们可以用于标识资源的类型、状态、版本等。 Labels通常用于标识资源的类型、状态、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsx(v,{children:e.jsx(y,{children:n})})})]})}function Ae(){const{currentRow:s}=E(),n=p.useMemo(()=>!s||!s.metadata.annotations?[]:Object.entries(s.metadata.annotations).map(([t,a])=>e.jsxs(m,{children:[e.jsx(o,{className:"font-medium",children:t}),e.jsx(o,{children:a}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{types:"edit",kind:"annotation",name:s.metadata.name,keys:t,values:typeof a=="string"?a:""}),e.jsx(k,{types:"delete",kind:"annotation",name:s.metadata.name,keys:t,values:typeof a=="string"?a:""})]})})]},t)),[s]);return e.jsxs(w,{children:[e.jsxs(O,{children:[e.jsxs(M,{children:["Annotations",e.jsx(k,{types:"add",kind:"annotation",name:s?s.metadata.name:"",keys:"",values:""})]}),e.jsx(D,{children:"Annotations是Kubernetes中用于存储元数据的字段。它们通常用于存储额外的信息，例如描述、标签等。 Annotations可以是任意的键值对，它们可以用于存储任何类型的信息，例如描述、标签、版本等。 Annotations通常用于存储元数据，例如描述、标签、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsx(v,{children:e.jsx(y,{children:n})})})]})}function Ie({currentRow:s}){const n=p.useMemo(()=>{var t,a;return!s||!((t=s.status)!=null&&t.images)?[]:Object.entries(((a=s.status)==null?void 0:a.images)||{}).map(([l,i])=>e.jsxs(m,{children:[i.names&&e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"max-w-[40vw] overflow-hidden whitespace-nowrap text-ellipsis hover:overflow-visible hover:whitespace-normal",children:i.names[0]}),e.jsx(o,{className:"max-w-[40vw] overflow-hidden whitespace-nowrap text-ellipsis hover:overflow-visible hover:whitespace-normal",children:i.names.length>1?i.names[1]:""})]}),e.jsx(o,{children:function(){const r=i.sizeBytes;return r<1024?`${r} B`:r<1048576?`${(r/1024).toFixed(2)} KB`:r<1073741824?`${(r/1048576).toFixed(2)} MB`:`${(r/1073741824).toFixed(2)} GB`}()})]},l||Math.random()))},[s]);return e.jsx(e.Fragment,{children:e.jsxs(w,{className:"mt-4",children:[e.jsxs(O,{children:[e.jsx(M,{children:"节点镜像"}),e.jsx(D,{children:"节点镜像是指节点上运行的镜像。这些镜像包含了节点的操作系统、运行时和应用程序。 节点镜像通常是由Kubernetes管理的，Kubernetes会自动下载和管理这些镜像。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(v,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(j,{children:"Hash"}),e.jsx(j,{children:"镜像"}),e.jsx(j,{className:"w-[10vh]",children:"大小"})]})}),e.jsx(y,{children:n})]})})]})})}function ke({currentRow:s}){const n=p.useMemo(()=>{var a,l,i;if(!s)return[];let t=[];return s.spec&&(t=t.concat(Object.entries(s.spec).map(([r,c])=>e.jsxs(m,{children:[e.jsxs(o,{className:"font-medium",children:["spec.",r]}),e.jsx(o,{children:r==="taints"?JSON.stringify(c):String(c)})]},`spec-${r}`)))),(a=s.status)!=null&&a.addresses&&(t=t.concat(s.status.addresses.map((r,c)=>e.jsxs(m,{children:[e.jsxs(o,{className:"font-medium",children:["status.addresses[",c,"].",r.type]}),e.jsx(o,{children:String(r.address)})]},`address-${c}`)))),(l=s.status)!=null&&l.daemonEndpoints&&(t=t.concat(Object.entries(s.status.daemonEndpoints).map(([r,c])=>e.jsxs(m,{children:[e.jsxs(o,{className:"font-medium",children:["status.daemonEndpoints.",r]}),e.jsx(o,{children:String(c.Port)})]},`daemonEndpoints-${r}`)))),(i=s.status)!=null&&i.nodeInfo&&(t=t.concat(Object.entries(s.status.nodeInfo).map(([r,c])=>e.jsxs(m,{children:[e.jsx(o,{className:"font-medium",children:r}),e.jsx(o,{children:String(c)})]},r)))),t},[s]);return e.jsx(e.Fragment,{children:e.jsxs(w,{className:"mt-4",children:[e.jsxs(O,{children:[e.jsx(M,{children:"节点信息"}),e.jsx(D,{children:"节点信息是Kubernetes中用于描述节点的字段。它们通常用于标识节点的类型、状态、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsx(v,{className:"max-h-[300px] overflow-y-auto",children:e.jsx(y,{children:n})})})]})})}function Pe({currentRow:s}){var a;const n=p.useMemo(()=>{var l;return!s||!((l=s.status)!=null&&l.conditions)?[]:Object.entries(s.status.conditions).map(([i,r])=>e.jsxs(m,{children:[e.jsx(o,{children:r.type}),e.jsx(o,{className:`font-medium ${r.status==="True"?"text-green-500":"text-red-500"}`,children:r.status}),e.jsx(o,{children:r.reason}),e.jsx(o,{children:r.message}),e.jsx(o,{children:new Date(r.lastHeartbeatTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),e.jsx(o,{children:new Date(r.lastTransitionTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},i))},[s]),t=p.useMemo(()=>!s||!s.spec.taints?[]:Object.entries(s.spec.taints).map(([l,i])=>e.jsxs(m,{children:[e.jsx(o,{className:"text-red-500",children:i.effect}),e.jsx(o,{children:i.key}),e.jsx(o,{children:i.value})]},l)),[s]);return e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:"mt-4",children:[e.jsxs(O,{children:[e.jsx(M,{children:"Conditions"}),e.jsx(D,{children:"Conditions是Kubernetes中用于描述节点或Pod状态的字段。它们通常用于指示节点或Pod是否正常运行，以及是否有任何问题需要注意。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(v,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(j,{children:"类型"}),e.jsx(j,{children:"状态"}),e.jsx(j,{children:"原因"}),e.jsx(j,{children:"消息"}),e.jsx(j,{children:"最近一次心跳"}),e.jsx(j,{children:"最近一次通信"})]})}),e.jsx(y,{children:n})]})})]}),((a=s==null?void 0:s.spec)==null?void 0:a.taints)&&e.jsxs(w,{className:"mt-4",children:[e.jsxs(O,{children:[e.jsx(M,{children:"污点"}),e.jsx(D,{children:"Taints是Kubernetes中的一个概念，用于标记节点或Pod，以防止它们被调度到不合适的节点上。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(v,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(j,{children:"Effect"}),e.jsx(j,{children:"Key"}),e.jsx(j,{children:"Value"})]})}),e.jsx(y,{children:t})]})})]})]})}function Ee({currentRow:s}){var t;const n=p.useMemo(()=>!s||!s.spec.taints?[]:Object.entries(s.spec.taints).map(([a,l])=>e.jsxs(m,{children:[e.jsx(o,{className:"text-red-500",children:l.effect}),e.jsx(o,{children:l.key}),e.jsx(o,{children:l.value})]},a)),[s]);return e.jsx(e.Fragment,{children:((t=s==null?void 0:s.spec)==null?void 0:t.taints)&&e.jsxs(w,{className:"mt-4",children:[e.jsxs(O,{children:[e.jsx(M,{children:"污点"}),e.jsx(D,{children:"Taints是Kubernetes中的一个概念，用于标记节点或Pod，以防止它们被调度到不合适的节点上。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(v,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(j,{children:"Effect"}),e.jsx(j,{children:"Key"}),e.jsx(j,{children:"Value"})]})}),e.jsx(y,{children:n})]})})]})})}function He({currentRow:s}){const n=(a,l)=>{if(l==="cpu"||l==="pods"||l==="hugepages-1Gi"||l==="hugepages-2Mi"||l==="ephemeral-storage")return String(a);if(typeof a!="number"){if(typeof a=="string"){const c=a.match(/(\d+)([a-zA-Z]+)/);if(c){const h=parseInt(c[1],10);switch(c[2]){case"Ki":a=h*1024;break;case"Mi":a=h*1024*1024;break;case"Gi":a=h*1024*1024*1024;break;default:return"N/A"}}else return"N/A"}}const i=["B","KB","MB","GB"];let r=0;for(;a>=1024&&r<i.length-1;)a/=1024,r++;return`${a.toFixed(2)} ${i[r]}`},t=p.useMemo(()=>{var l,i;if(!s||!((l=s.status)!=null&&l.allocatable)||!((i=s.status)!=null&&i.capacity))return[];const a=new Set([...Object.keys(s.status.allocatable),...Object.keys(s.status.capacity)]);return Array.from(a).map(r=>{const c=s.status.allocatable[r]||0,h=s.status.capacity[r]||0;return e.jsxs(m,{children:[e.jsx(o,{className:"font-medium",children:r}),e.jsx(o,{children:n(c,r)}),e.jsx(o,{children:n(h,r)})]},`combined-${r}`)})},[s]);return e.jsx(e.Fragment,{children:e.jsxs(w,{className:"mt-4",children:[e.jsxs(O,{children:[e.jsx(M,{children:"节点信息"}),e.jsx(D,{children:"节点信息是Kubernetes中用于描述节点的字段。它们通常用于标识节点的类型、状态、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(v,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(m,{children:[e.jsx(j,{children:"类型"}),e.jsx(j,{children:"可分配"}),e.jsx(j,{children:"容量"})]})}),e.jsx(y,{children:t})]})})]})})}function Je({open:s,onOpenChange:n,nodeName:t}){var l,i,r,c,h,d,b,g,u,x,f,H;const{currentRow:a}=E();return e.jsx(ye,{open:s,onOpenChange:n,children:e.jsxs(we,{className:"h-full mt-0",children:[e.jsxs(de,{className:"flex justify-center items-center mb-5",children:[t," 节点详情",e.jsx(Ce,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsxs(oe,{defaultValue:"nodeinfo",className:"w-full",children:[e.jsxs(he,{className:"grid w-full grid-cols-8 gap-2",children:[e.jsxs(S,{value:"nodeinfo",children:["节点信息",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(l=a==null?void 0:a.status)!=null&&l.nodeInfo?Object.keys((i=a.status)==null?void 0:i.nodeInfo).length:0})})]}),e.jsxs(S,{value:"capacity",children:["容量",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(r=a==null?void 0:a.status)!=null&&r.capacity?Object.keys((c=a.status)==null?void 0:c.capacity).length:0})})]}),e.jsxs(S,{value:"labels",children:["标签",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(h=a==null?void 0:a.metadata)!=null&&h.labels?Object.keys(a.metadata.labels).length:0})})]}),e.jsxs(S,{value:"annotations",children:["注释",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(d=a==null?void 0:a.metadata)!=null&&d.annotations?Object.keys(a.metadata.annotations).length:0})})]}),e.jsxs(S,{value:"conditions",children:["告警",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(b=a==null?void 0:a.status)!=null&&b.conditions?Object.keys((g=a.status)==null?void 0:g.conditions).length:0})})]}),e.jsxs(S,{value:"taints",children:["污点",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(u=a==null?void 0:a.spec)!=null&&u.taints?Object.keys((x=a.spec)==null?void 0:x.taints).length:0})})]}),e.jsxs(S,{value:"images",children:["镜像",e.jsx($,{className:"h-5 w-5 ml-1",children:e.jsx(A,{className:"text-xs",children:(f=a==null?void 0:a.status)!=null&&f.images?Object.keys((H=a.status)==null?void 0:H.images).length:0})})]}),e.jsx(S,{value:"rawdata",children:"原始JSON"})]}),e.jsx(T,{value:"nodeinfo",className:"h-[80vh] overflow-y-auto",children:e.jsx(ke,{currentRow:a})}),e.jsx(T,{value:"capacity",className:"h-[80vh] overflow-y-auto",children:e.jsx(He,{currentRow:a})}),e.jsx(T,{value:"labels",className:"h-[80vh] overflow-y-auto",children:e.jsx("div",{className:"flex-1 max-h-full overflow-y-auto",children:e.jsx($e,{})})}),e.jsx(T,{value:"annotations",className:"h-[80vh] overflow-y-auto",children:e.jsx("div",{className:"flex-1 max-h-full overflow-y-auto",children:e.jsx(Ae,{})})}),e.jsx(T,{value:"images",className:"h-[80vh] overflow-y-auto",children:e.jsx(Ie,{currentRow:a})}),e.jsx(T,{value:"conditions",className:"h-[80vh] overflow-y-auto",children:e.jsx(Pe,{currentRow:a})}),e.jsx(T,{value:"taints",className:"h-[80vh] overflow-y-auto",children:e.jsx(Ee,{currentRow:a})}),e.jsx(T,{value:"rawdata",className:"h-[80vh] overflow-y-auto",children:e.jsx(w,{children:e.jsx(C,{className:"space-y-2",children:e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(Se,{src:a||{},enableClipboard:!0,displayDataTypes:!1,name:!1})})})})})]})})]})})}function Be(){const{open:s,setOpen:n,currentRow:t,setCurrentRow:a,setNodeName:l}=E();return e.jsx(e.Fragment,{children:t&&e.jsx(Je,{open:s==="detail",onOpenChange:()=>{n(null),l(void 0),setTimeout(()=>{a(null)},500)},nodeName:t==null?void 0:t.metadata.name},"node-detail")})}function ze(){const[s,n]=p.useState([]),t=async()=>{try{const a=await F.post("/api/gvr/list",{group:"",version:"v1",resource:"nodes",namespace:""});n(a.data.items);const l=await F.get("/api/monitor/metrics/node"),i=a.data.items.map(r=>({...r,metrics:l.data.items.find(c=>c.metadata.name===r.metadata.name)}));n(i),console.log("请求接口成功 metrics:",i)}catch(a){N({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(a,null,2)})})})}};return p.useEffect(()=>{t();const a=setInterval(t,1e4);return()=>clearInterval(a)},[]),e.jsxs(Fe,{children:[e.jsxs(xe,{fixed:!0,children:[e.jsx(me,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ue,{}),e.jsx(je,{})]})]}),e.jsxs(pe,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Kubernetes Nodes"}),e.jsx("p",{className:"text-muted-foreground",children:"查看和管理您的Kubernetes集群节点信息"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(I,{variant:"outline",size:"sm",onClick:t,children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"刷新"]})})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ke,{data:s,columns:Me})})]}),e.jsx(Be,{})]})}const _e=fe("/_authenticated/nodes/")({component:ze});export{_e as Route};
