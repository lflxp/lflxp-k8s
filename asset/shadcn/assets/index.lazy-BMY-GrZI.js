import{j as e,d as w,Q as q,R as B,B as m,V as J,W as b,X as U,Y as y,r as d,s as _,_ as S,a9 as Y,aa as $,ab as Q,ac as W,ad as D,ae as R,af as X,I,a2 as Z,aE as V,a5 as M,H as ee,p as se,T as ae,q as te,M as re,c as ne}from"./index-B1ZXdEgv.js";import{A as F,a as P,C as le,E as ie,P as oe,f as ce,g as de,b as xe,c as me,d as he,e as ge}from"./react-icons.esm-DfBn7391.js";import{u as ue,g as pe,h as je,i as fe,j as ve,k as Ne,l as we,T as H,a as E,b as f,c as v,f as T,d as A,e as u,n as Ce}from"./table-DqV8PWYy.js";import{P as be,a as ye,b as Se}from"./popover-B8YD6lJu.js";import{S as De,a as Re,b as Fe,c as Pe,d as Te}from"./select-BV3M1mNM.js";import{D as L,c as ke,a as z,d as Ie,e as Ve,J as Me,f as He,b as G}from"./main-DLfVeK_1.js";import"./index-B9NU5RqY.js";function j({column:s,title:r,className:a}){return s.getCanSort()?e.jsx("div",{className:w("flex items-center space-x-2",a),children:e.jsxs(q,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:r}),s.getIsSorted()==="desc"?e.jsx(F,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(P,{className:"ml-2 h-4 w-4"}):e.jsx(le,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(J,{align:"start",children:[e.jsxs(b,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(P,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(b,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(F,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(U,{}),e.jsxs(b,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(ie,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:w(a),children:r})}const K=d.createContext(null);function Ee({children:s}){const[r,a]=y.useState(null),[i,n]=y.useState(null),[t,o]=y.useState(void 0);return e.jsx(K.Provider,{value:{open:r,setOpen:a,currentRow:i,setCurrentRow:n,CRDName:t,setCRDName:o},children:s})}const O=()=>{const s=d.useContext(K);if(!s)throw new Error("useCRDs must be used within a CRDsProvider");return s},Ae=[{accessorKey:"name",header:({column:s})=>e.jsx(j,{column:s,title:"Name"}),cell:({row:s})=>{const{setOpen:r,setCurrentRow:a}=O(),i=()=>{a(s.original),r("detail")};return e.jsx("div",{children:s.original.name.includes("/")?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap text-gray-500 cursor-default",children:s.original.name}):e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:i,children:s.original.name})})},enableSorting:!0,enableHiding:!1},{accessorKey:"shortNames",header:({column:s})=>e.jsx(j,{column:s,title:"Short Names"}),cell:({row:s})=>s.original.shortNames?s.original.shortNames[0]:"N/A",enableSorting:!0,enableHiding:!1},{accessorKey:"version",header:({column:s})=>e.jsx(j,{column:s,title:"API Version"}),cell:({row:s})=>s.original.version||"",enableSorting:!0,enableHiding:!1},{accessorKey:"group",header:({column:s})=>e.jsx(j,{column:s,title:"Group"}),cell:({row:s})=>s.original.group||"N/A",enableSorting:!0,enableHiding:!1},{accessorKey:"namespaces",header:({column:s})=>e.jsx(j,{column:s,title:"Namespaced"}),cell:({row:s})=>s.original.namespaced?e.jsx("div",{className:"font-bold text-xs text-green-500",children:s.original.namespaced?"true":"false"}):e.jsx("div",{className:"font-bold text-xs text-red-500",children:s.original.namespaced?"true":"false"}),enableSorting:!1,enableHiding:!1},{accessorKey:"kind",header:({column:s})=>e.jsx(j,{column:s,title:"Kind"}),cell:({row:s})=>s.original.kind,enableSorting:!0,enableHiding:!1},{id:"verbs",header:({column:s})=>e.jsx(j,{column:s,title:"Verbs"}),cell:({row:s})=>{var r;return(r=s.original)!=null&&r.verbs&&s.original.verbs.length>0?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible",children:s.original.verbs.join(", ")}):""},enableSorting:!0,enableHiding:!1}];function k({column:s,title:r,options:a}){const i=s==null?void 0:s.getFacetedUniqueValues(),n=new Set(s==null?void 0:s.getFilterValue());return e.jsxs(be,{children:[e.jsx(ye,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(oe,{className:"mr-2 h-4 w-4"}),r,(n==null?void 0:n.size)>0&&e.jsxs(e.Fragment,{children:[e.jsx(_,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(S,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:n.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:n.size>2?e.jsxs(S,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[n.size," selected"]}):a.filter(t=>n.has(t.value)).map(t=>e.jsx(S,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:t.label},t.value))})]})]})}),e.jsx(Se,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Y,{children:[e.jsx($,{placeholder:r}),e.jsxs(Q,{children:[e.jsx(W,{children:"No results found."}),e.jsx(D,{children:a.map(t=>{const o=n.has(t.value);return e.jsxs(R,{onSelect:()=>{o?n.delete(t.value):n.add(t.value);const l=Array.from(n);s==null||s.setFilterValue(l.length?l:void 0)},children:[e.jsx("div",{className:w("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ce,{className:w("h-4 w-4")})}),t.icon&&e.jsx(t.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:t.label}),(i==null?void 0:i.get(t.value))&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:i.get(t.value)})]},t.value)})}),n.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(X,{}),e.jsx(D,{children:e.jsx(R,{onSelect:()=>s==null?void 0:s.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Le=({fetchData:s})=>e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:s,variant:"outline",children:"刷新"})});function ze({table:s,originalData:r,fetchData:a}){var o;const i=s.getState().columnFilters.length>0,n=[...new Set(r.map(l=>l.version))].map(l=>({value:l,label:l})),t=[...new Set(r.map(l=>l.group))].map(l=>({value:l,label:l}));return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(I,{placeholder:"Filter tasks...",value:((o=s.getColumn("name"))==null?void 0:o.getFilterValue())??"",onChange:l=>{var x;return(x=s.getColumn("name"))==null?void 0:x.setFilterValue(l.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("version")&&e.jsx(k,{column:s.getColumn("version"),title:"API Version 筛选",options:n}),s.getColumn("group")&&e.jsx(k,{column:s.getColumn("group"),title:"Group 筛选",options:t})]}),i&&e.jsxs(m,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(de,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Le,{fetchData:a})]})}function Ge({table:s}){return e.jsxs("div",{className:"flex items-center justify-between overflow-clip px-2",style:{overflowClipMargin:1},children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[s.getFilteredSelectedRowModel().rows.length," of"," ",s.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(De,{value:`${s.getState().pagination.pageSize}`,onValueChange:r=>{s.setPageSize(Number(r))},children:[e.jsx(Re,{className:"h-8 w-[70px]",children:e.jsx(Fe,{placeholder:s.getState().pagination.pageSize})}),e.jsx(Pe,{side:"top",children:[5,10,20,30,40,50].map(r=>e.jsx(Te,{value:`${r}`,children:r},r))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",s.getState().pagination.pageIndex+1," of"," ",s.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(xe,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(me,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(he,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(ge,{className:"h-4 w-4"})]})]})]})]})}function Ke({columns:s,data:r,fetchData:a}){var N;const[i,n]=d.useState({}),[t,o]=d.useState({}),[l,x]=d.useState([]),[c,C]=d.useState([]),p=ue({data:r,columns:s,state:{sorting:c,columnVisibility:t,rowSelection:i,columnFilters:l},enableRowSelection:!0,onRowSelectionChange:n,onSortingChange:C,onColumnFiltersChange:x,onColumnVisibilityChange:o,getCoreRowModel:we(),getFilteredRowModel:Ne(),getPaginationRowModel:ve(),getSortedRowModel:fe(),getFacetedRowModel:je(),getFacetedUniqueValues:pe()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(ze,{table:p,originalData:r,fetchData:a}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(E,{children:p.getHeaderGroups().map(h=>e.jsx(f,{children:h.headers.map(g=>e.jsx(v,{children:g.isPlaceholder?null:T(g.column.columnDef.header,g.getContext())},g.id))},h.id))}),e.jsx(A,{children:(N=p.getRowModel().rows)!=null&&N.length?p.getRowModel().rows.map(h=>e.jsx(f,{"data-state":h.getIsSelected()&&"selected",children:h.getVisibleCells().map(g=>e.jsx(u,{children:T(g.column.columnDef.cell,g.getContext())},g.id))},h.id)):e.jsx(f,{children:e.jsx(u,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})}),e.jsx(Ge,{table:p})]})}function Oe({columns:s,data:r,fetchData:a}){return e.jsx(Ke,{columns:s,data:r,fetchData:a})}function qe(s,r){return e.jsxs(L,{children:[e.jsx(ke,{asChild:!0,children:e.jsx(m,{variant:"link",className:"text-blue-400 hover:text-green-600",children:r})}),e.jsxs(z,{className:"bg-white h-[70vh] w-full",children:[e.jsx(Ie,{children:e.jsx(Ve,{children:r})}),e.jsx("div",{style:{maxHeight:"60vh",overflowY:"auto"},children:e.jsx(Me,{src:s})}),e.jsx(He,{children:e.jsx(G,{asChild:!0,children:e.jsx(m,{type:"button",children:"关闭"})})})]})]})}function Be({open:s,onOpenChange:r,CRDName:a,data:i,fetchData:n}){d.useEffect(()=>{n()},[]);const[t,o]=d.useState(""),l=d.useMemo(()=>t?i.filter(c=>c.metadata.name.toLowerCase().includes(t.toLowerCase())||c.metadata.namespace&&c.metadata.namespace.toLowerCase().includes(t.toLowerCase())):i,[t,i]),x=c=>{o(c.target.value)};return e.jsx(L,{open:s,onOpenChange:r,children:e.jsxs(z,{className:"px-4",children:[e.jsxs(Z,{className:"flex justify-center items-center mb-5",children:[a," 节点详情",e.jsx(G,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsxs("div",{className:"h-[80vh] space-y-4 h-max-[450px] w-full overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white pb-2",children:e.jsx(I,{onChange:x,placeholder:"搜索Name or Namespace"})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(v,{className:"w-[150px] text-gray-600 font-medium",children:"Name"}),e.jsx(v,{className:"text-gray-600 font-medium",children:"Kind"}),e.jsx(v,{className:"text-gray-600 font-medium",children:"Namespace"}),e.jsx(v,{className:"text-right text-gray-600 font-medium",children:"Creation Timestamp"})]})}),e.jsx(A,{children:l.map(c=>e.jsxs(f,{className:"hover:bg-gray-100 transition-colors",children:[e.jsx(u,{className:"font-medium text-blue-600 hover:underline cursor-pointer",children:qe(c,c.metadata.name)}),e.jsx(u,{className:"text-gray-700",children:c.kind}),e.jsx(u,{className:"text-gray-700",children:c.metadata.namespace||"N/A"}),e.jsx(u,{className:"text-right text-gray-700",children:new Date(c.metadata.creationTimestamp).toLocaleString()})]},c.metadata.uid))}),e.jsx(Ce,{children:e.jsxs(f,{children:[e.jsx(u,{colSpan:3,className:"font-semibold text-gray-700",children:"总计"}),e.jsx(u,{className:"text-right font-semibold text-gray-700",children:l.length})]})})]})})]})]})})}function Je(){const{open:s,setOpen:r,currentRow:a,setCurrentRow:i,setCRDName:n}=O(),[t,o]=d.useState([]),l=async()=>{try{const x=await V.post("/api/gvr/list",{resource:a==null?void 0:a.name,group:(a==null?void 0:a.version)===void 0?"":a==null?void 0:a.group,version:(a==null?void 0:a.version)===void 0?a==null?void 0:a.group:a==null?void 0:a.version,namespace:""});o(x.data.items)}catch(x){M({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(x,null,2)})})})}};return d.useEffect(()=>{l()},[]),e.jsx(e.Fragment,{children:a&&e.jsx(Be,{open:s==="detail",onOpenChange:()=>{r(null),n(void 0),setTimeout(()=>{i(null)},500)},CRDName:a==null?void 0:a.name,data:t,fetchData:l},"CRD-detail")})}function Ue(){const[s,r]=d.useState([]),a=async()=>{try{const i=await V.get("/api/gvr/all"),n=[];i.data.apiresourceListSlice.forEach(t=>{t.resources.forEach(o=>{const l=t.groupVersion.split("/")[0],x=t.groupVersion.split("/")[1],c=o.kind,C=o.name,p=o.namespaced,N=o.singularName,h=o.shortNames||[];n.push({group:l,version:x,kind:c,name:C,namespaced:p,singularName:N,shortNames:h,verbs:o.verbs})})}),i.data.apigroup.forEach(t=>{if(t.name!==""){const o=t.name,l=t.preferredVersion.version;n.push({group:o,version:l,kind:"",name:t.name,namespaced:"",singularName:"",shortNames:[],verbs:[]})}}),r(n)}catch(i){M({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(i,null,2)})})})}};return d.useEffect(()=>{a()},[]),e.jsxs(Ee,{children:[e.jsxs(ee,{fixed:!0,children:[e.jsx(se,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ae,{}),e.jsx(te,{})]})]}),e.jsxs(re,{children:[e.jsx("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"自定义资源"}),e.jsx("p",{className:"text-muted-foreground",children:"查看所有自定义资源"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Oe,{data:s,columns:Ae,fetchData:a})})]}),e.jsx(Je,{})]})}const es=ne("/_authenticated/crds/")({component:Ue});export{es as Route};
