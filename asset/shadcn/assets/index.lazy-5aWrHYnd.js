import{j as e,d as V,Q as X,R as Y,B as A,V as Z,W as J,X as R,Y as z,r as f,_ as ee,a7 as U,a5 as y,bl as se,ao as ae,bm as te,ap as ne,aq as le,ar as ie,as as re,I as L,at as ce,au as de,aI as I,C as w,aB as F,aC as M,aD as O,aE as C,a2 as oe,aJ as he,aK as xe,aL as S,aM as K,aN as $,aO as T,H as me,p as ue,T as je,q as pe,M as fe,c as ge}from"./index-XYqRjLsj.js";import{A as W,a as G,C as Ne,E as be}from"./react-icons.esm-BQXzbcxC.js";import{T as b,d as v,b as x,e as o,u as ve,l as ye,a as P,c as u,f as q}from"./table-C080KiNt.js";import{D as we,a as Ce,b as Se,J as Te,R as Fe}from"./main-D0vpv5cZ.js";function _({column:s,title:r,className:t}){return s.getCanSort()?e.jsx("div",{className:V("flex items-center space-x-2",t),children:e.jsxs(X,{children:[e.jsx(Y,{asChild:!0,children:e.jsxs(A,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:r}),s.getIsSorted()==="desc"?e.jsx(W,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(G,{className:"ml-2 h-4 w-4"}):e.jsx(Ne,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(Z,{align:"start",children:[e.jsxs(J,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(G,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(J,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(W,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs(J,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(be,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:V(t),children:r})}const Q=f.createContext(null);function Me({children:s}){const[r,t]=z.useState(null),[a,n]=z.useState(null),[l,i]=z.useState(void 0);return e.jsx(Q.Provider,{value:{open:r,setOpen:t,currentRow:a,setCurrentRow:n,nodeName:l,setNodeName:i},children:s})}const B=()=>{const s=f.useContext(Q);if(!s)throw new Error("useNodes must be used within a NodesProvider");return s},Oe=[{id:"status",header:"状态",cell:({row:s})=>{var c,h;const r=((h=(c=s.original)==null?void 0:c.status)==null?void 0:h.conditions)||[],t=r.find(d=>d.type==="Ready"),a=r.filter(d=>d.type!=="Ready").every(d=>d.status==="False"),n=t&&t.status==="True"||a?"Active":"警告",l=t&&t.status==="True"||a?"green":"red",i=r.filter(d=>d.type==="Ready"&&d.status==="False"||d.type!=="Ready"&&d.status==="True").map(d=>d.message).join(`
`);return e.jsx("span",{style:{color:l},title:i,children:n})}},{id:"name",header:({column:s})=>e.jsx(_,{column:s,title:"节点名称"}),cell:({row:s})=>{var l,i;const{setOpen:r,setCurrentRow:t}=B(),a=()=>{r("detail"),t(s.original)},n=((i=(l=s.original)==null?void 0:l.metadata)==null?void 0:i.labels)||{};return Object.keys(n).filter(c=>c.startsWith("node-role.kubernetes.io/")).map(c=>c.replace("node-role.kubernetes.io/","")).join(", "),e.jsx("div",{children:e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:a,children:s.original.metadata.name})})},enableSorting:!1,enableHiding:!1},{id:"roles",header:({column:s})=>e.jsx(_,{column:s,title:"角色"}),cell:({row:s})=>{var a,n;const r=((n=(a=s.original)==null?void 0:a.metadata)==null?void 0:n.labels)||{},t=Object.keys(r).filter(l=>l.startsWith("node-role.kubernetes.io/")).map(l=>l.replace("node-role.kubernetes.io/","")).map(l=>e.jsx(ee,{className:"ml-1 bg-green-600",children:l},l));return e.jsx("div",{className:"overflow-hidden text-ellipsis whitespace-nowrap hover:overflow-visible flex items-center",children:t.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:t}):"-"})},enableSorting:!0,enableHiding:!1},{id:"Kubernetes",header:"Kubernetes",cell:({row:s})=>{var t,a,n;return((n=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.nodeInfo)==null?void 0:n.kubeletVersion)||"N/A"}},{id:"cpu",header:"CPU核数",cell:({row:s})=>{var t,a,n;return((n=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.allocatable)==null?void 0:n.cpu)||"N/A"}},{id:"memory",header:"内存容量",cell:({row:s})=>{var n,l,i;const r=(i=(l=(n=s.original)==null?void 0:n.status)==null?void 0:l.capacity)==null?void 0:i.memory;return(c=>{if(!c)return"0";if(c.endsWith("Ki")){let h=parseFloat(c);if(h>1024){let d=h/1024;return d>1024?`${(d/1024).toFixed(0)} Gi`:`${d.toFixed(0)} Mi`}else return`${h.toFixed(0)} Ki`}if(c.endsWith("Mi")){let h=parseFloat(c);return h>1024?`${(h/1024).toFixed(0)} Gi`:`${h.toFixed(0)} Mi`}return c})(r)||"N/A"}},{accessorKey:"pods",header:"Pod数量",cell:({row:s})=>{var t,a,n;return((n=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.allocatable)==null?void 0:n.pods)||"N/A"}},{accessorKey:"creationTimestamp",header:"运行时间",cell:({row:s})=>{var c;const r=(c=s.original.metadata)==null?void 0:c.creationTimestamp;if(!r)return"N/A";const t=Date.now()-new Date(r).getTime(),a=Math.floor(t/1e3),n=Math.floor(a/60),l=Math.floor(n/60),i=Math.floor(l/24);return i>0?`${i}d`:l>0?`${l}h`:n>0?`${n}m`:`${a}s`}},{id:"ip",header:"IP地址",cell:({row:s})=>{var t,a,n;return(((n=(a=(t=s.original)==null?void 0:t.status)==null?void 0:a.addresses)==null?void 0:n.filter(l=>l.type==="InternalIP"))||[]).map(l=>e.jsx(U,{className:"text-blue-600",children:l.address},l.type))}},{accessorKey:"cpuUsage",header:"CPU使用率",cell:({row:s})=>{var r,t,a,n,l;try{const i=(a=(t=(r=s.original)==null?void 0:r.status)==null?void 0:t.allocatable)==null?void 0:a.cpu,c=(n=s.original)==null?void 0:n.metrics,h=(l=c==null?void 0:c.usage)==null?void 0:l.cpu,d=N=>N?N.endsWith("m")?parseFloat(N)/1e3:N.endsWith("n")?parseFloat(N)/1e9:parseFloat(N):0,j=d(i),m=d(h),g=j&&m?m/j*100:null;return g?e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"w-full h-6 rounded-full border border-gray-200 bg-gray-100 overflow-hidden relative",children:[e.jsx("div",{className:`h-full transition-all duration-300 absolute top-0 left-0 ${g<30?"bg-green-400":g<60?"bg-yellow-400":g<80?"bg-orange-400":"bg-red-500"}`,style:{width:`${g}%`}}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800 z-10",children:[g.toFixed(2),"%"]})]})}):"N/A"}catch(i){y({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(i,null,2)})})})}}},{accessorKey:"memoryUsage",header:"内存使用率",cell:({row:s})=>{var r,t,a;try{const n=(t=(r=s.original.status)==null?void 0:r.allocatable)==null?void 0:t.memory,l=s.original.metrics,i=(a=l==null?void 0:l.usage)==null?void 0:a.memory,c=m=>m?m.endsWith("Ki")?parseFloat(m)*1024:m.endsWith("Mi")?parseFloat(m)*1024*1024:m.endsWith("Gi")?parseFloat(m)*1024*1024*1024:parseFloat(m):0,h=c(n),d=c(i),j=h&&d?d/h*100:null;return j?e.jsx("div",{className:"relative w-full",children:e.jsxs("div",{className:"w-full h-6 rounded-full border border-gray-200 bg-gray-100 overflow-hidden relative",children:[e.jsx("div",{className:`h-full transition-all duration-300 absolute top-0 left-0 ${j<30?"bg-green-400":j<60?"bg-yellow-400":j<80?"bg-orange-400":"bg-red-500"}`,style:{width:`${j}%`}}),e.jsxs("span",{className:"absolute inset-0 flex items-center justify-center text-xs font-medium text-gray-800 z-10",children:[j.toFixed(2),"%"]})]})}):"N/A"}catch(n){y({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(n,null,2)})})})}}}];function De({columns:s,data:r}){var a;if(!s||!r)return e.jsx("div",{className:"rounded-md border",children:e.jsx(b,{children:e.jsx(v,{children:e.jsx(x,{children:e.jsx(o,{colSpan:(s==null?void 0:s.length)||0,className:"h-24 text-center",children:"没有数据"})})})})});const t=ve({data:r,columns:s,getCoreRowModel:ye()});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(b,{children:[e.jsx(P,{children:t.getHeaderGroups().map(n=>e.jsx(x,{children:n.headers.map(l=>e.jsx(u,{children:l.isPlaceholder?null:q(l.column.columnDef.header,l.getContext())},l.id))},n.id))}),e.jsx(v,{children:(a=t.getRowModel().rows)!=null&&a.length?t.getRowModel().rows.map(n=>e.jsx(x,{"data-state":n.getIsSelected()&&"selected",children:n.getVisibleCells().map(l=>e.jsx(o,{children:q(l.column.columnDef.cell,l.getContext())},l.id))},n.id)):e.jsx(x,{children:e.jsx(o,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})})}function Ke({columns:s,data:r}){return e.jsx(De,{columns:s,data:r})}function $e(){return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(A,{children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"添加节点"]})})}function k({types:s,kind:r,name:t,keys:a,values:n}){const{currentRow:l,setCurrentRow:i}=B(),[c,h]=f.useState(""),[d,j]=f.useState(""),m=async()=>{if(!d||!c){y({title:"键或值不能为空",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d,value:c},null,2)})})});return}try{if(r==="label"){const p=await I.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{labels:{[d]:c}}}});i(p.data)}else if(r==="annotation"){const p=await I.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{annotations:{[d]:c}}}});i(p.data)}y({title:"请求成功",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d,value:c},null,2)})})})}catch(p){y({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(p,null,2)})})})}},g=async()=>{var p,E;if(!d){y({title:"键不能为空",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d},null,2)})})});return}if(window.confirm(`确定要删除键 ${d} 吗？`))try{if(r==="label"){const D={...l};(p=D.metadata)!=null&&p.labels&&delete D.metadata.labels[d];const H=await I.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{labels:{[d]:null}}}});i(H.data)}else if(r==="annotation"){const D={...l};(E=D.metadata)!=null&&E.annotations&&delete D.metadata.annotations[d];const H=await I.patch("/api/gvr/patchstrate",{group:"",version:"v1",resource:"nodes",name:t,patchdatastrate:{metadata:{annotations:{[d]:null}}}});i(H.data)}y({title:"删除成功",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify({key:d,value:c},null,2)})})})}catch(D){y({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(D,null,2)})})})}};f.useEffect(()=>{h(n),j(a)},[n,a]);const N=()=>{s==="add"||s==="edit"?m():s==="delete"&&g()};return e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:s==="edit"?e.jsx(A,{size:"sm",variant:"link",className:"w-20 text-blue-300 hover:text-blue-500",onClick:m,children:"编辑"}):s==="delete"?e.jsx(A,{size:"sm",variant:"link",className:"w-20 text-red-300 hover:text-red-500",onClick:g,children:"删除"}):s==="add"?e.jsx(A,{size:"sm",variant:"link",className:"w-20 text-green-300 hover:text-green-500",onClick:m,children:"添加"}):null}),e.jsxs(ne,{side:"top",children:[e.jsxs(le,{children:[e.jsxs(ie,{children:[s==="edit"?"编辑":s==="add"?"添加":s==="delete"?"删除":null," 节点 ",t," ",r==="label"?"标签":r==="annotation"?"注释":""]}),e.jsxs(re,{children:["新增节点 ",t," ",r==="label"?"标签":r==="annotation"?"注释":"","，请填写相关信息。",s==="edit"?"编辑节点":s==="add"?"添加节点":s==="delete"?"删除节点":null," ",t," ",r==="label"?"标签":r==="annotation"?"注释":"","，请填写相关信息。"]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(U,{htmlFor:"name",className:"text-right",children:"键"}),e.jsx(L,{id:"name",value:d,disabled:s!=="add",onChange:p=>j(p.target.value),className:"col-span-3"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(U,{htmlFor:"username",className:"text-right",children:"值"}),e.jsx(L,{id:"username",value:c,onChange:p=>h(p.target.value),className:"col-span-3"})]})]}),e.jsx(ce,{children:e.jsx(de,{asChild:!0,children:e.jsx(A,{type:"submit",onClick:N,children:"提交"})})})]})]})}function Ae(){const{currentRow:s}=B(),r=f.useMemo(()=>!s||!s.metadata.labels?[]:Object.entries(s.metadata.labels).map(([t,a])=>{var n;return e.jsxs(x,{children:[e.jsx(o,{className:"font-medium",children:t}),e.jsx(o,{children:a}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{types:"edit",kind:"label",name:((n=s==null?void 0:s.metadata)==null?void 0:n.name)||"",keys:t,values:typeof a=="string"?a:""}),e.jsx(k,{types:"delete",kind:"label",name:s.metadata.name,keys:t,values:typeof a=="string"?a:""})]})})]},t)}),[s]);return e.jsxs(w,{children:[e.jsxs(F,{children:[e.jsxs(M,{children:["Labels",e.jsx(k,{types:"add",kind:"label",name:s?s.metadata.name:"",keys:"",values:""})]}),e.jsx(O,{children:"Labels是Kubernetes中用于标识资源的字段。它们通常用于标识资源的类型、状态、版本等。 Labels可以是任意的键值对，它们可以用于标识资源的类型、状态、版本等。 Labels通常用于标识资源的类型、状态、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsx(b,{children:e.jsx(v,{children:r})})})]})}function Ie(){const{currentRow:s}=B(),r=f.useMemo(()=>!s||!s.metadata.annotations?[]:Object.entries(s.metadata.annotations).map(([t,a])=>e.jsxs(x,{children:[e.jsx(o,{className:"font-medium",children:t}),e.jsx(o,{children:a}),e.jsx(o,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(k,{types:"edit",kind:"annotation",name:s.metadata.name,keys:t,values:typeof a=="string"?a:""}),e.jsx(k,{types:"delete",kind:"annotation",name:s.metadata.name,keys:t,values:typeof a=="string"?a:""})]})})]},t)),[s]);return e.jsxs(w,{children:[e.jsxs(F,{children:[e.jsxs(M,{children:["Annotations",e.jsx(k,{types:"add",kind:"annotation",name:s?s.metadata.name:"",keys:"",values:""})]}),e.jsx(O,{children:"Annotations是Kubernetes中用于存储元数据的字段。它们通常用于存储额外的信息，例如描述、标签等。 Annotations可以是任意的键值对，它们可以用于存储任何类型的信息，例如描述、标签、版本等。 Annotations通常用于存储元数据，例如描述、标签、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsx(b,{children:e.jsx(v,{children:r})})})]})}function ke({currentRow:s}){const r=f.useMemo(()=>{var t,a;return!s||!((t=s.status)!=null&&t.images)?[]:Object.entries(((a=s.status)==null?void 0:a.images)||{}).map(([n,l])=>e.jsxs(x,{children:[l.names&&e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"max-w-[40vw] overflow-hidden whitespace-nowrap text-ellipsis hover:overflow-visible hover:whitespace-normal",children:l.names[0]}),e.jsx(o,{className:"max-w-[40vw] overflow-hidden whitespace-nowrap text-ellipsis hover:overflow-visible hover:whitespace-normal",children:l.names.length>1?l.names[1]:""})]}),e.jsx(o,{children:function(){const i=l.sizeBytes;return i<1024?`${i} B`:i<1048576?`${(i/1024).toFixed(2)} KB`:i<1073741824?`${(i/1048576).toFixed(2)} MB`:`${(i/1073741824).toFixed(2)} GB`}()})]},n||Math.random()))},[s]);return e.jsx(e.Fragment,{children:e.jsxs(w,{className:"mt-4",children:[e.jsxs(F,{children:[e.jsx(M,{children:"节点镜像"}),e.jsx(O,{children:"节点镜像是指节点上运行的镜像。这些镜像包含了节点的操作系统、运行时和应用程序。 节点镜像通常是由Kubernetes管理的，Kubernetes会自动下载和管理这些镜像。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(b,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(x,{children:[e.jsx(u,{children:"Hash"}),e.jsx(u,{children:"镜像"}),e.jsx(u,{className:"w-[10vh]",children:"大小"})]})}),e.jsx(v,{children:r})]})})]})})}function Pe({currentRow:s}){const r=f.useMemo(()=>{var a,n,l;if(!s)return[];let t=[];return s.spec&&(t=t.concat(Object.entries(s.spec).map(([i,c])=>e.jsxs(x,{children:[e.jsxs(o,{className:"font-medium",children:["spec.",i]}),e.jsx(o,{children:i==="taints"?JSON.stringify(c):String(c)})]},`spec-${i}`)))),(a=s.status)!=null&&a.addresses&&(t=t.concat(s.status.addresses.map((i,c)=>e.jsxs(x,{children:[e.jsxs(o,{className:"font-medium",children:["status.addresses[",c,"].",i.type]}),e.jsx(o,{children:String(i.address)})]},`address-${c}`)))),(n=s.status)!=null&&n.daemonEndpoints&&(t=t.concat(Object.entries(s.status.daemonEndpoints).map(([i,c])=>e.jsxs(x,{children:[e.jsxs(o,{className:"font-medium",children:["status.daemonEndpoints.",i]}),e.jsx(o,{children:String(c.Port)})]},`daemonEndpoints-${i}`)))),(l=s.status)!=null&&l.nodeInfo&&(t=t.concat(Object.entries(s.status.nodeInfo).map(([i,c])=>e.jsxs(x,{children:[e.jsx(o,{className:"font-medium",children:i}),e.jsx(o,{children:String(c)})]},i)))),t},[s]);return e.jsx(e.Fragment,{children:e.jsxs(w,{className:"mt-4",children:[e.jsxs(F,{children:[e.jsx(M,{children:"节点信息"}),e.jsx(O,{children:"节点信息是Kubernetes中用于描述节点的字段。它们通常用于标识节点的类型、状态、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsx(b,{className:"max-h-[300px] overflow-y-auto",children:e.jsx(v,{children:r})})})]})})}function Be({currentRow:s}){var a;const r=f.useMemo(()=>{var n;return!s||!((n=s.status)!=null&&n.conditions)?[]:Object.entries(s.status.conditions).map(([l,i])=>e.jsxs(x,{children:[e.jsx(o,{children:i.type}),e.jsx(o,{className:`font-medium ${i.status==="True"?"text-green-500":"text-red-500"}`,children:i.status}),e.jsx(o,{children:i.reason}),e.jsx(o,{children:i.message}),e.jsx(o,{children:new Date(i.lastHeartbeatTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}),e.jsx(o,{children:new Date(i.lastTransitionTime).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})})]},l))},[s]),t=f.useMemo(()=>!s||!s.spec.taints?[]:Object.entries(s.spec.taints).map(([n,l])=>e.jsxs(x,{children:[e.jsx(o,{className:"text-red-500",children:l.effect}),e.jsx(o,{children:l.key}),e.jsx(o,{children:l.value})]},n)),[s]);return e.jsxs(e.Fragment,{children:[e.jsxs(w,{className:"mt-4",children:[e.jsxs(F,{children:[e.jsx(M,{children:"Conditions"}),e.jsx(O,{children:"Conditions是Kubernetes中用于描述节点或Pod状态的字段。它们通常用于指示节点或Pod是否正常运行，以及是否有任何问题需要注意。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(b,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(x,{children:[e.jsx(u,{children:"类型"}),e.jsx(u,{children:"状态"}),e.jsx(u,{children:"原因"}),e.jsx(u,{children:"消息"}),e.jsx(u,{children:"最近一次心跳"}),e.jsx(u,{children:"最近一次通信"})]})}),e.jsx(v,{children:r})]})})]}),((a=s==null?void 0:s.spec)==null?void 0:a.taints)&&e.jsxs(w,{className:"mt-4",children:[e.jsxs(F,{children:[e.jsx(M,{children:"污点"}),e.jsx(O,{children:"Taints是Kubernetes中的一个概念，用于标记节点或Pod，以防止它们被调度到不合适的节点上。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(b,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(x,{children:[e.jsx(u,{children:"Effect"}),e.jsx(u,{children:"Key"}),e.jsx(u,{children:"Value"})]})}),e.jsx(v,{children:t})]})})]})]})}function Ee({currentRow:s}){var t;const r=f.useMemo(()=>!s||!s.spec.taints?[]:Object.entries(s.spec.taints).map(([a,n])=>e.jsxs(x,{children:[e.jsx(o,{className:"text-red-500",children:n.effect}),e.jsx(o,{children:n.key}),e.jsx(o,{children:n.value})]},a)),[s]);return e.jsx(e.Fragment,{children:((t=s==null?void 0:s.spec)==null?void 0:t.taints)&&e.jsxs(w,{className:"mt-4",children:[e.jsxs(F,{children:[e.jsx(M,{children:"污点"}),e.jsx(O,{children:"Taints是Kubernetes中的一个概念，用于标记节点或Pod，以防止它们被调度到不合适的节点上。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(b,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(x,{children:[e.jsx(u,{children:"Effect"}),e.jsx(u,{children:"Key"}),e.jsx(u,{children:"Value"})]})}),e.jsx(v,{children:r})]})})]})})}function He({currentRow:s}){const r=(a,n)=>{if(n==="cpu"||n==="pods"||n==="hugepages-1Gi"||n==="hugepages-2Mi"||n==="ephemeral-storage")return String(a);if(typeof a!="number"){if(typeof a=="string"){const c=a.match(/(\d+)([a-zA-Z]+)/);if(c){const h=parseInt(c[1],10);switch(c[2]){case"Ki":a=h*1024;break;case"Mi":a=h*1024*1024;break;case"Gi":a=h*1024*1024*1024;break;default:return"N/A"}}else return"N/A"}}const l=["B","KB","MB","GB"];let i=0;for(;a>=1024&&i<l.length-1;)a/=1024,i++;return`${a.toFixed(2)} ${l[i]}`},t=f.useMemo(()=>{var n,l;if(!s||!((n=s.status)!=null&&n.allocatable)||!((l=s.status)!=null&&l.capacity))return[];const a=new Set([...Object.keys(s.status.allocatable),...Object.keys(s.status.capacity)]);return Array.from(a).map(i=>{const c=s.status.allocatable[i]||0,h=s.status.capacity[i]||0;return e.jsxs(x,{children:[e.jsx(o,{className:"font-medium",children:i}),e.jsx(o,{children:r(c,i)}),e.jsx(o,{children:r(h,i)})]},`combined-${i}`)})},[s]);return e.jsx(e.Fragment,{children:e.jsxs(w,{className:"mt-4",children:[e.jsxs(F,{children:[e.jsx(M,{children:"节点信息"}),e.jsx(O,{children:"节点信息是Kubernetes中用于描述节点的字段。它们通常用于标识节点的类型、状态、版本等。"})]}),e.jsx(C,{className:"space-y-2",children:e.jsxs(b,{className:"max-h-[300px] overflow-y-auto",children:[e.jsx(P,{children:e.jsxs(x,{children:[e.jsx(u,{children:"类型"}),e.jsx(u,{children:"可分配"}),e.jsx(u,{children:"容量"})]})}),e.jsx(v,{children:t})]})})]})})}function Je({open:s,onOpenChange:r,nodeName:t}){var n,l,i,c,h,d,j,m,g,N,p,E;const{currentRow:a}=B();return e.jsx(we,{open:s,onOpenChange:r,children:e.jsxs(Ce,{className:"h-full mt-0",children:[e.jsxs(oe,{className:"flex justify-center items-center mb-5",children:[t," 节点详情",e.jsx(Se,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsx("div",{className:"w-full h-full",children:e.jsxs(he,{defaultValue:"nodeinfo",className:"w-full",children:[e.jsxs(xe,{className:"grid w-full grid-cols-8 gap-2",children:[e.jsxs(S,{value:"nodeinfo",children:["节点信息",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(n=a==null?void 0:a.status)!=null&&n.nodeInfo?Object.keys((l=a.status)==null?void 0:l.nodeInfo).length:0})})]}),e.jsxs(S,{value:"capacity",children:["容量",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(i=a==null?void 0:a.status)!=null&&i.capacity?Object.keys((c=a.status)==null?void 0:c.capacity).length:0})})]}),e.jsxs(S,{value:"labels",children:["标签",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(h=a==null?void 0:a.metadata)!=null&&h.labels?Object.keys(a.metadata.labels).length:0})})]}),e.jsxs(S,{value:"annotations",children:["注释",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(d=a==null?void 0:a.metadata)!=null&&d.annotations?Object.keys(a.metadata.annotations).length:0})})]}),e.jsxs(S,{value:"conditions",children:["告警",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(j=a==null?void 0:a.status)!=null&&j.conditions?Object.keys((m=a.status)==null?void 0:m.conditions).length:0})})]}),e.jsxs(S,{value:"taints",children:["污点",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(g=a==null?void 0:a.spec)!=null&&g.taints?Object.keys((N=a.spec)==null?void 0:N.taints).length:0})})]}),e.jsxs(S,{value:"images",children:["镜像",e.jsx(K,{className:"h-5 w-5 ml-1",children:e.jsx($,{className:"text-xs",children:(p=a==null?void 0:a.status)!=null&&p.images?Object.keys((E=a.status)==null?void 0:E.images).length:0})})]}),e.jsx(S,{value:"rawdata",children:"原始JSON"})]}),e.jsx(T,{value:"nodeinfo",className:"h-[80vh] overflow-y-auto",children:e.jsx(Pe,{currentRow:a})}),e.jsx(T,{value:"capacity",className:"h-[80vh] overflow-y-auto",children:e.jsx(He,{currentRow:a})}),e.jsx(T,{value:"labels",className:"h-[80vh] overflow-y-auto",children:e.jsx("div",{className:"flex-1 max-h-full overflow-y-auto",children:e.jsx(Ae,{})})}),e.jsx(T,{value:"annotations",className:"h-[80vh] overflow-y-auto",children:e.jsx("div",{className:"flex-1 max-h-full overflow-y-auto",children:e.jsx(Ie,{currentRow:a})})}),e.jsx(T,{value:"images",className:"h-[80vh] overflow-y-auto",children:e.jsx(ke,{currentRow:a})}),e.jsx(T,{value:"conditions",className:"h-[80vh] overflow-y-auto",children:e.jsx(Be,{currentRow:a})}),e.jsx(T,{value:"taints",className:"h-[80vh] overflow-y-auto",children:e.jsx(Ee,{currentRow:a})}),e.jsx(T,{value:"rawdata",className:"h-[80vh] overflow-y-auto",children:e.jsx(w,{children:e.jsx(C,{className:"space-y-2",children:e.jsx("div",{className:"flex justify-start mb-4",children:e.jsx(Te,{src:a||{},enableClipboard:!0,displayDataTypes:!1,name:!1})})})})})]})})]})})}function ze(){const{open:s,setOpen:r,currentRow:t,setCurrentRow:a,setNodeName:n}=B();return e.jsx(e.Fragment,{children:t&&e.jsx(Je,{open:s==="detail",onOpenChange:()=>{r(null),n(void 0),setTimeout(()=>{a(null)},500)},nodeName:t==null?void 0:t.metadata.name},"node-detail")})}function Ue(){const[s,r]=f.useState([]),t=async()=>{try{const a=await I.post("/api/gvr/list",{group:"",version:"v1",resource:"nodes",namespace:""});r(a.data.items);const n=await I.get("/api/monitor/metrics/node"),l=a.data.items.map(i=>({...i,metrics:n.data.items.find(c=>c.metadata.name===i.metadata.name)}));r(l),console.log("请求接口成功 metrics:",l)}catch(a){y({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(a,null,2)})})})}};return f.useEffect(()=>{t()},[]),e.jsxs(Me,{children:[e.jsxs(me,{fixed:!0,children:[e.jsx(ue,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(je,{}),e.jsx(pe,{})]})]}),e.jsxs(fe,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Kubernetes Nodes"}),e.jsx("p",{className:"text-muted-foreground",children:"查看和管理您的Kubernetes集群节点信息"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($e,{}),e.jsxs(A,{variant:"outline",size:"sm",onClick:t,children:[e.jsx(Fe,{className:"h-4 w-4 mr-2"}),"刷新"]})]})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ke,{data:s,columns:Oe})})]}),e.jsx(ze,{})]})}const qe=ge("/_authenticated/nodes/")({component:Ue});export{qe as Route};
