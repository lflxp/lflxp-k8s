import{j as e,d as b,Q as V,R as A,B as g,V as O,W as u,X as P,Y as p,r as h,ao as F,bl as L,ap as q,aq as z,ar as B,at as G,au as J,a2 as K,aI as D,a5 as S,H as Q,p as U,T as W,q as X,M as Y,c as _}from"./index-DIz91kq1.js";import{A as v,a as w,C as Z,E as $}from"./react-icons.esm-Dz6ND8ra.js";import{T as j,d as f,b as x,e as c,u as ee,l as se,a as y,c as m,f as C,m as ae,n as te}from"./table-fUaVV9X6.js";import{D as re,a as ne,b as le,R as ie}from"./drawer-DXhVnXTu.js";import{T as oe}from"./textarea-BnyXuWXK.js";function d({column:s,title:t,className:r}){return s.getCanSort()?e.jsx("div",{className:b("flex items-center space-x-2",r),children:e.jsxs(V,{children:[e.jsx(A,{asChild:!0,children:e.jsxs(g,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:t}),s.getIsSorted()==="desc"?e.jsx(v,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(w,{className:"ml-2 h-4 w-4"}):e.jsx(Z,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(O,{align:"start",children:[e.jsxs(u,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(w,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(u,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(v,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsxs(u,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx($,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:b(r),children:t})}const T=h.createContext(null);function ce({children:s}){const[t,r]=p.useState(null),[a,l]=p.useState(null),[n,o]=p.useState(void 0);return e.jsx(T.Provider,{value:{open:t,setOpen:r,currentRow:a,setCurrentRow:l,CRDName:n,setCRDName:o},children:s})}const N=()=>{const s=h.useContext(T);if(!s)throw new Error("useCRDs must be used within a CRDsProvider");return s},de=[{id:"name",header:({column:s})=>e.jsx(d,{column:s,title:"Name"}),cell:({row:s})=>{const{setOpen:t,setCurrentRow:r}=N(),a=()=>{r(s.original),t("detail")};return e.jsx("div",{children:s.original.name.includes("/")?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap text-gray-500 cursor-default",children:s.original.name}):e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:a,children:s.original.name})})},enableSorting:!1,enableHiding:!1},{id:"shortNames",header:({column:s})=>e.jsx(d,{column:s,title:"Short Names"}),cell:({row:s})=>s.original.shortNames?s.original.shortNames[0]:"N/A",enableSorting:!0,enableHiding:!1},{id:"apiversion",header:({column:s})=>e.jsx(d,{column:s,title:"API Version"}),cell:({row:s})=>s.original.version||"",enableSorting:!0,enableHiding:!1},{id:"group",header:({column:s})=>e.jsx(d,{column:s,title:"Group"}),cell:({row:s})=>s.original.group||"N/A",enableSorting:!0,enableHiding:!1},{id:"namespaces",header:({column:s})=>e.jsx(d,{column:s,title:"Namespaced"}),cell:({row:s})=>s.original.namespaced?e.jsx("div",{className:"text-xs text-green-500",children:s.original.namespaced?"true":"false"}):e.jsx("div",{className:"text-xs text-red-500",children:s.original.namespaced?"true":"false"}),enableSorting:!0,enableHiding:!1},{id:"kind",header:({column:s})=>e.jsx(d,{column:s,title:"Kind"}),cell:({row:s})=>s.original.kind,enableSorting:!0,enableHiding:!1},{id:"verbs",header:({column:s})=>e.jsx(d,{column:s,title:"Verbs"}),cell:({row:s})=>{var t;return(t=s.original)!=null&&t.verbs&&s.original.verbs.length>0?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible",children:s.original.verbs.join(", ")}):""},enableSorting:!0,enableHiding:!1}];function xe({columns:s,data:t}){var a;if(!s||!t)return e.jsx("div",{className:"rounded-md border",children:e.jsx(j,{children:e.jsx(f,{children:e.jsx(x,{children:e.jsx(c,{colSpan:(s==null?void 0:s.length)||0,className:"h-24 text-center",children:"没有数据"})})})})});const r=ee({data:t,columns:s,getCoreRowModel:se()});return e.jsx("div",{className:"rounded-md border",children:e.jsxs(j,{children:[e.jsx(y,{children:r.getHeaderGroups().map(l=>e.jsx(x,{children:l.headers.map(n=>e.jsx(m,{children:n.isPlaceholder?null:C(n.column.columnDef.header,n.getContext())},n.id))},l.id))}),e.jsx(f,{children:(a=r.getRowModel().rows)!=null&&a.length?r.getRowModel().rows.map(l=>e.jsx(x,{"data-state":l.getIsSelected()&&"selected",children:l.getVisibleCells().map(n=>e.jsx(c,{children:C(n.column.columnDef.cell,n.getContext())},n.id))},l.id)):e.jsx(x,{children:e.jsx(c,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})})}function he({columns:s,data:t}){return e.jsx(xe,{columns:s,data:t})}function me(s,t){return e.jsxs(F,{children:[e.jsx(L,{asChild:!0,children:e.jsx(g,{variant:"link",children:t})}),e.jsxs(q,{className:"w-[45%] sm:max-w-[425px]",children:[e.jsx(z,{children:e.jsx(B,{children:t})}),e.jsx("div",{className:"h-full",children:e.jsx("div",{className:"items-center h-full w-full",children:e.jsx(oe,{className:"h-full w-full",placeholder:"Type your message here.",value:JSON.stringify(s,null,2),readOnly:!0})})}),e.jsx(G,{children:e.jsx(J,{asChild:!0,children:e.jsx(g,{type:"submit",children:"关闭"})})})]})]})}function ge({open:s,onOpenChange:t,CRDName:r}){const{currentRow:a}=N(),[l,n]=h.useState([]),o=async()=>{try{console.log("请求接口参数:",a);const i=await D.post("/api/gvr/list",{resource:a==null?void 0:a.name,group:(a==null?void 0:a.version)===void 0?"":a==null?void 0:a.group,version:(a==null?void 0:a.version)===void 0?a==null?void 0:a.group:a==null?void 0:a.version,namespace:""});console.log("请求接口成功:",i.data.items),n(i.data.items||[])}catch(i){S({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(i,null,2)})})})}};return h.useEffect(()=>{o()},[]),e.jsx(re,{open:s,onOpenChange:t,children:e.jsxs(ne,{className:"h-full mt-0",children:[e.jsxs(K,{className:"flex justify-center items-center mb-5",children:[r," 节点详情",e.jsx(le,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsx("div",{className:"w-full h-full overflow-y-auto p-4 bg-gray-50 rounded-lg shadow-md",children:e.jsxs(j,{className:"min-w-full border border-gray-200",children:[e.jsx(ae,{className:"text-lg font-semibold text-gray-700",children:a.kind}),e.jsx(y,{className:"bg-gray-100",children:e.jsxs(x,{children:[e.jsx(m,{className:"w-[150px] text-gray-600 font-medium",children:"Name"}),e.jsx(m,{className:"text-gray-600 font-medium",children:"Kind"}),e.jsx(m,{className:"text-gray-600 font-medium",children:"Namespace"}),e.jsx(m,{className:"text-right text-gray-600 font-medium",children:"Creation Timestamp"})]})}),e.jsx(f,{children:l.map(i=>e.jsxs(x,{className:"hover:bg-gray-100 transition-colors",children:[e.jsx(c,{className:"font-medium text-blue-600 hover:underline cursor-pointer",children:me(i,i.metadata.name)}),e.jsx(c,{className:"text-gray-700",children:i.kind}),e.jsx(c,{className:"text-gray-700",children:i.metadata.namespace||"N/A"}),e.jsx(c,{className:"text-right text-gray-700",children:new Date(i.metadata.creationTimestamp).toLocaleString()})]},i.metadata.uid))}),e.jsx(te,{className:"bg-gray-100",children:e.jsxs(x,{children:[e.jsx(c,{colSpan:3,className:"font-semibold text-gray-700",children:"Total"}),e.jsx(c,{className:"text-right font-semibold text-gray-700",children:l.length})]})})]})})]})})}function ue(){const{open:s,setOpen:t,currentRow:r,setCurrentRow:a,setCRDName:l}=N();return e.jsx(e.Fragment,{children:r&&e.jsx(ge,{open:s==="detail",onOpenChange:()=>{t(null),l(void 0),setTimeout(()=>{a(null)},500)},CRDName:r==null?void 0:r.name},"CRD-detail")})}function pe(){const[s,t]=h.useState([]),r=async()=>{try{const a=await D.get("/api/gvr/all");console.log("请求接口成功:",a.data);const l=[];a.data.apiresourceListSlice.forEach(n=>{n.resources.forEach(o=>{const i=n.groupVersion.split("/")[0],R=n.apiVersion,H=o.kind,k=o.name,I=o.namespaced,M=o.singularName,E=o.shortNames||[];l.push({group:i,version:R,kind:H,name:k,namespaced:I,singularName:M,shortNames:E,verbs:o.verbs})})}),a.data.apigroup.forEach(n=>{if(n.name!==""){const o=n.name,i=n.preferredVersion.version;l.push({group:o,version:i,kind:"",name:n.name,namespaced:"",singularName:"",shortNames:[],verbs:[]})}}),t(l)}catch(a){S({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(a,null,2)})})})}};return h.useEffect(()=>{r();const a=setInterval(r,1e4);return()=>clearInterval(a)},[]),e.jsxs(ce,{children:[e.jsxs(Q,{fixed:!0,children:[e.jsx(U,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(W,{}),e.jsx(X,{})]})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"自定义资源"}),e.jsx("p",{className:"text-muted-foreground",children:"查看所有自定义资源"})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:r,children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"刷新"]})})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(he,{data:s,columns:de})})]}),e.jsx(ue,{})]})}const we=_("/_authenticated/crds/")({component:pe});export{we as Route};
