import{j as e,d as w,Q as G,R as K,B as m,V as O,W as b,X as q,r as d,Y as S,s as B,_ as y,a9 as U,aa as J,ab as _,ac as $,ad as D,ae as R,af as Q,I,ao as W,aD as X,ap as Y,aq as Z,ar as ee,at as se,au as ae,a2 as te,aE as V,a5 as M,H as ne,p as re,T as le,q as ie,M as oe,c as ce}from"./index-Sj8PalxT.js";import{A as T,a as F,C as de,E as xe,P as me,f as he,g as ge,b as ue,c as pe,d as je,e as fe}from"./react-icons.esm-CmOjNWrw.js";import{u as Ne,g as ve,h as we,i as Ce,j as be,k as Se,l as ye,T as H,a as E,b as f,c as N,f as P,d as A,e as u,n as De}from"./table-Y-QFyalC.js";import{P as Re,a as Te,b as Fe}from"./popover-CKBiPf50.js";import{S as Pe,a as ke,b as Ie,c as Ve,d as Me}from"./select-CMBpdrj9.js";import{D as He,a as Ee,b as Ae}from"./drawer-BexXwk-V.js";import{T as Le}from"./textarea-Du6n_54Z.js";import"./index-CcR2qwFx.js";function j({column:s,title:n,className:a}){return s.getCanSort()?e.jsx("div",{className:w("flex items-center space-x-2",a),children:e.jsxs(G,{children:[e.jsx(K,{asChild:!0,children:e.jsxs(m,{variant:"ghost",size:"sm",className:"-ml-3 h-8 data-[state=open]:bg-accent",children:[e.jsx("span",{children:n}),s.getIsSorted()==="desc"?e.jsx(T,{className:"ml-2 h-4 w-4"}):s.getIsSorted()==="asc"?e.jsx(F,{className:"ml-2 h-4 w-4"}):e.jsx(de,{className:"ml-2 h-4 w-4"})]})}),e.jsxs(O,{align:"start",children:[e.jsxs(b,{onClick:()=>s.toggleSorting(!1),children:[e.jsx(F,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Asc"]}),e.jsxs(b,{onClick:()=>s.toggleSorting(!0),children:[e.jsx(T,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Desc"]}),s.getCanHide()&&e.jsxs(e.Fragment,{children:[e.jsx(q,{}),e.jsxs(b,{onClick:()=>s.toggleVisibility(!1),children:[e.jsx(xe,{className:"mr-2 h-3.5 w-3.5 text-muted-foreground/70"}),"Hide"]})]})]})]})}):e.jsx("div",{className:w(a),children:n})}const L=d.createContext(null);function ze({children:s}){const[n,a]=S.useState(null),[i,r]=S.useState(null),[t,o]=S.useState(void 0);return e.jsx(L.Provider,{value:{open:n,setOpen:a,currentRow:i,setCurrentRow:r,CRDName:t,setCRDName:o},children:s})}const z=()=>{const s=d.useContext(L);if(!s)throw new Error("useCRDs must be used within a CRDsProvider");return s},Ge=[{accessorKey:"name",header:({column:s})=>e.jsx(j,{column:s,title:"Name"}),cell:({row:s})=>{const{setOpen:n,setCurrentRow:a}=z(),i=()=>{a(s.original),n("detail")};return e.jsx("div",{children:s.original.name.includes("/")?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap text-gray-500 cursor-default",children:s.original.name}):e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible text-blue-500 hover:text-blue-600 cursor-pointer",onClick:i,children:s.original.name})})},enableSorting:!0,enableHiding:!1},{accessorKey:"shortNames",header:({column:s})=>e.jsx(j,{column:s,title:"Short Names"}),cell:({row:s})=>s.original.shortNames?s.original.shortNames[0]:"N/A",enableSorting:!0,enableHiding:!1},{accessorKey:"version",header:({column:s})=>e.jsx(j,{column:s,title:"API Version"}),cell:({row:s})=>s.original.version||"",enableSorting:!0,enableHiding:!1},{accessorKey:"group",header:({column:s})=>e.jsx(j,{column:s,title:"Group"}),cell:({row:s})=>s.original.group||"N/A",enableSorting:!0,enableHiding:!1},{accessorKey:"namespaces",header:({column:s})=>e.jsx(j,{column:s,title:"Namespaced"}),cell:({row:s})=>s.original.namespaced?e.jsx("div",{className:"font-bold text-xs text-green-500",children:s.original.namespaced?"true":"false"}):e.jsx("div",{className:"font-bold text-xs text-red-500",children:s.original.namespaced?"true":"false"}),enableSorting:!1,enableHiding:!1},{accessorKey:"kind",header:({column:s})=>e.jsx(j,{column:s,title:"Kind"}),cell:({row:s})=>s.original.kind,enableSorting:!0,enableHiding:!1},{id:"verbs",header:({column:s})=>e.jsx(j,{column:s,title:"Verbs"}),cell:({row:s})=>{var n;return(n=s.original)!=null&&n.verbs&&s.original.verbs.length>0?e.jsx("div",{className:"w-48 overflow-hidden text-ellipsis whitespace-nowrap hover:whitespace-normal hover:overflow-visible",children:s.original.verbs.join(", ")}):""},enableSorting:!0,enableHiding:!1}];function k({column:s,title:n,options:a}){const i=s==null?void 0:s.getFacetedUniqueValues(),r=new Set(s==null?void 0:s.getFilterValue());return e.jsxs(Re,{children:[e.jsx(Te,{asChild:!0,children:e.jsxs(m,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),n,(r==null?void 0:r.size)>0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(y,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:r.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:r.size>2?e.jsxs(y,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[r.size," selected"]}):a.filter(t=>r.has(t.value)).map(t=>e.jsx(y,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:t.label},t.value))})]})]})}),e.jsx(Fe,{className:"w-[200px] p-0",align:"start",children:e.jsxs(U,{children:[e.jsx(J,{placeholder:n}),e.jsxs(_,{children:[e.jsx($,{children:"No results found."}),e.jsx(D,{children:a.map(t=>{const o=r.has(t.value);return e.jsxs(R,{onSelect:()=>{o?r.delete(t.value):r.add(t.value);const l=Array.from(r);s==null||s.setFilterValue(l.length?l:void 0)},children:[e.jsx("div",{className:w("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",o?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(he,{className:w("h-4 w-4")})}),t.icon&&e.jsx(t.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:t.label}),(i==null?void 0:i.get(t.value))&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:i.get(t.value)})]},t.value)})}),r.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Q,{}),e.jsx(D,{children:e.jsx(R,{onSelect:()=>s==null?void 0:s.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}const Ke=({fetchData:s})=>e.jsx("div",{className:"flex gap-2",children:e.jsx(m,{onClick:s,variant:"outline",children:"刷新"})});function Oe({table:s,originalData:n,fetchData:a}){var o;const i=s.getState().columnFilters.length>0,r=[...new Set(n.map(l=>l.version))].map(l=>({value:l,label:l})),t=[...new Set(n.map(l=>l.group))].map(l=>({value:l,label:l}));return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(I,{placeholder:"Filter tasks...",value:((o=s.getColumn("name"))==null?void 0:o.getFilterValue())??"",onChange:l=>{var x;return(x=s.getColumn("name"))==null?void 0:x.setFilterValue(l.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),e.jsxs("div",{className:"flex gap-x-2",children:[s.getColumn("version")&&e.jsx(k,{column:s.getColumn("version"),title:"API Version 筛选",options:r}),s.getColumn("group")&&e.jsx(k,{column:s.getColumn("group"),title:"Group 筛选",options:t})]}),i&&e.jsxs(m,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(ge,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Ke,{fetchData:a})]})}function qe({table:s}){return e.jsxs("div",{className:"flex items-center justify-between overflow-clip px-2",style:{overflowClipMargin:1},children:[e.jsxs("div",{className:"hidden flex-1 text-sm text-muted-foreground sm:block",children:[s.getFilteredSelectedRowModel().rows.length," of"," ",s.getFilteredRowModel().rows.length," row(s) selected."]}),e.jsxs("div",{className:"flex items-center sm:space-x-6 lg:space-x-8",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"hidden text-sm font-medium sm:block",children:"Rows per page"}),e.jsxs(Pe,{value:`${s.getState().pagination.pageSize}`,onValueChange:n=>{s.setPageSize(Number(n))},children:[e.jsx(ke,{className:"h-8 w-[70px]",children:e.jsx(Ie,{placeholder:s.getState().pagination.pageSize})}),e.jsx(Ve,{side:"top",children:[5,10,20,30,40,50].map(n=>e.jsx(Me,{value:`${n}`,children:n},n))})]})]}),e.jsxs("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",s.getState().pagination.pageIndex+1," of"," ",s.getPageCount()]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(m,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(0),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to first page"}),e.jsx(ue,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.previousPage(),disabled:!s.getCanPreviousPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to previous page"}),e.jsx(pe,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>s.nextPage(),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to next page"}),e.jsx(je,{className:"h-4 w-4"})]}),e.jsxs(m,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>s.setPageIndex(s.getPageCount()-1),disabled:!s.getCanNextPage(),children:[e.jsx("span",{className:"sr-only",children:"Go to last page"}),e.jsx(fe,{className:"h-4 w-4"})]})]})]})]})}function Be({columns:s,data:n,fetchData:a}){var v;const[i,r]=d.useState({}),[t,o]=d.useState({}),[l,x]=d.useState([]),[c,C]=d.useState([]),p=Ne({data:n,columns:s,state:{sorting:c,columnVisibility:t,rowSelection:i,columnFilters:l},enableRowSelection:!0,onRowSelectionChange:r,onSortingChange:C,onColumnFiltersChange:x,onColumnVisibilityChange:o,getCoreRowModel:ve(),getFilteredRowModel:we(),getPaginationRowModel:Ce(),getSortedRowModel:be(),getFacetedRowModel:Se(),getFacetedUniqueValues:ye()});return e.jsxs("div",{className:"space-y-4",children:[e.jsx(Oe,{table:p,originalData:n,fetchData:a}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(E,{children:p.getHeaderGroups().map(h=>e.jsx(f,{children:h.headers.map(g=>e.jsx(N,{children:g.isPlaceholder?null:P(g.column.columnDef.header,g.getContext())},g.id))},h.id))}),e.jsx(A,{children:(v=p.getRowModel().rows)!=null&&v.length?p.getRowModel().rows.map(h=>e.jsx(f,{"data-state":h.getIsSelected()&&"selected",children:h.getVisibleCells().map(g=>e.jsx(u,{children:P(g.column.columnDef.cell,g.getContext())},g.id))},h.id)):e.jsx(f,{children:e.jsx(u,{colSpan:s.length,className:"h-24 text-center",children:"没有数据"})})})]})}),e.jsx(qe,{table:p})]})}function Ue({columns:s,data:n,fetchData:a}){return e.jsx(Be,{columns:s,data:n,fetchData:a})}function Je(s,n){return e.jsxs(W,{children:[e.jsx(X,{asChild:!0,children:e.jsx(m,{variant:"link",className:"text-blue-400 hover:text-green-600",children:n})}),e.jsxs(Y,{className:"w-[45%] sm:max-w-[425px]",children:[e.jsx(Z,{children:e.jsx(ee,{children:n})}),e.jsx("div",{className:"h-full",children:e.jsx("div",{className:"items-center h-full w-full",children:e.jsx(Le,{className:"h-full w-full",placeholder:"Type your message here.",value:JSON.stringify(s,null,2),readOnly:!0})})}),e.jsx(se,{children:e.jsx(ae,{asChild:!0,children:e.jsx(m,{type:"submit",children:"关闭"})})})]})]})}function _e({open:s,onOpenChange:n,CRDName:a,data:i,fetchData:r}){d.useEffect(()=>{r()},[]);const[t,o]=d.useState(""),l=d.useMemo(()=>t?i.filter(c=>c.metadata.name.toLowerCase().includes(t.toLowerCase())||c.metadata.namespace&&c.metadata.namespace.toLowerCase().includes(t.toLowerCase())):i,[t,i]),x=c=>{o(c.target.value)};return e.jsx(He,{open:s,onOpenChange:n,children:e.jsxs(Ee,{className:"px-4",children:[e.jsxs(te,{className:"flex justify-center items-center mb-5",children:[a," 节点详情",e.jsx(Ae,{className:"absolute top-2 right-4",children:e.jsx("span",{className:"flex items-center justify-center w-6 h-6 cursor-pointer hover:scale-110 hover:font-bold transition-transform",children:"✕"})})]}),e.jsxs("div",{className:"h-[80vh] space-y-4 h-max-[450px] w-full overflow-y-auto",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white pb-2",children:e.jsx(I,{onChange:x,placeholder:"搜索Name or Namespace"})}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(H,{children:[e.jsx(E,{children:e.jsxs(f,{children:[e.jsx(N,{className:"w-[150px] text-gray-600 font-medium",children:"Name"}),e.jsx(N,{className:"text-gray-600 font-medium",children:"Kind"}),e.jsx(N,{className:"text-gray-600 font-medium",children:"Namespace"}),e.jsx(N,{className:"text-right text-gray-600 font-medium",children:"Creation Timestamp"})]})}),e.jsx(A,{children:l.map(c=>e.jsxs(f,{className:"hover:bg-gray-100 transition-colors",children:[e.jsx(u,{className:"font-medium text-blue-600 hover:underline cursor-pointer",children:Je(c,c.metadata.name)}),e.jsx(u,{className:"text-gray-700",children:c.kind}),e.jsx(u,{className:"text-gray-700",children:c.metadata.namespace||"N/A"}),e.jsx(u,{className:"text-right text-gray-700",children:new Date(c.metadata.creationTimestamp).toLocaleString()})]},c.metadata.uid))}),e.jsx(De,{children:e.jsxs(f,{children:[e.jsx(u,{colSpan:3,className:"font-semibold text-gray-700",children:"总计"}),e.jsx(u,{className:"text-right font-semibold text-gray-700",children:l.length})]})})]})})]})]})})}function $e(){const{open:s,setOpen:n,currentRow:a,setCurrentRow:i,setCRDName:r}=z(),[t,o]=d.useState([]),l=async()=>{try{const x=await V.post("/api/gvr/list",{resource:a==null?void 0:a.name,group:(a==null?void 0:a.version)===void 0?"":a==null?void 0:a.group,version:(a==null?void 0:a.version)===void 0?a==null?void 0:a.group:a==null?void 0:a.version,namespace:""});o(x.data.items)}catch(x){M({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(x,null,2)})})})}};return d.useEffect(()=>{l()},[]),e.jsx(e.Fragment,{children:a&&e.jsx(_e,{open:s==="detail",onOpenChange:()=>{n(null),r(void 0),setTimeout(()=>{i(null)},500)},CRDName:a==null?void 0:a.name,data:t,fetchData:l},"CRD-detail")})}function Qe(){const[s,n]=d.useState([]),a=async()=>{try{const i=await V.get("/api/gvr/all"),r=[];i.data.apiresourceListSlice.forEach(t=>{t.resources.forEach(o=>{const l=t.groupVersion.split("/")[0],x=t.groupVersion.split("/")[1],c=o.kind,C=o.name,p=o.namespaced,v=o.singularName,h=o.shortNames||[];r.push({group:l,version:x,kind:c,name:C,namespaced:p,singularName:v,shortNames:h,verbs:o.verbs})})}),i.data.apigroup.forEach(t=>{if(t.name!==""){const o=t.name,l=t.preferredVersion.version;r.push({group:o,version:l,kind:"",name:t.name,namespaced:"",singularName:"",shortNames:[],verbs:[]})}}),n(r)}catch(i){M({title:"请求接口出错",description:e.jsx("pre",{className:"mt-2 w-[340px] rounded-md bg-slate-950 p-4",children:e.jsx("code",{className:"text-white",children:JSON.stringify(i,null,2)})})})}};return d.useEffect(()=>{a()},[]),e.jsxs(ze,{children:[e.jsxs(ne,{fixed:!0,children:[e.jsx(re,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(le,{}),e.jsx(ie,{})]})]}),e.jsxs(oe,{children:[e.jsx("div",{className:"mb-2 flex flex-wrap items-center justify-between gap-x-4 space-y-2",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"自定义资源"}),e.jsx("p",{className:"text-muted-foreground",children:"查看所有自定义资源"})]})}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:e.jsx(Ue,{data:s,columns:Ge,fetchData:a})})]}),e.jsx($e,{})]})}const ns=ce("/_authenticated/crds/")({component:Qe});export{ns as Route};
